<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="author" content="shiwi"><meta name="copyright" content="SHIWIVI"><link rel="shortcut icon" href="/blog/images/favicon.ico" type="image/x-icon"><style>.preload{position:absolute;display:flex;flex-direction:column;align-items:center;justify-content:center;left:0;top:0;width:100%;height:100%;background-color:#000;z-index:100}.text{margin-bottom:10px;color:#00cff3;text-shadow:0 0 3px #00cff3;font-size:20px}.text span{display:inline-block}.dance{animation:dance .8s linear}.text span:nth-child(1){animation-delay:0s}.text span:nth-child(2){animation-delay:.1s}.text span:nth-child(3){animation-delay:.2s}.text span:nth-child(4){animation-delay:.3s}.text span:nth-child(5){animation-delay:.4s}.text span:nth-child(6){animation-delay:.5s}.text span:nth-child(7){animation-delay:.6s}.text span:nth-child(8){animation-delay:.7s}.text span:nth-child(9){animation-delay:.8s}.text span:nth-child(10){animation-delay:.9s}@keyframes dance{0%{transform:translateY(0)}50%{transform:translateY(-20px)}100%{transform:translateY(0)}}.loading{width:80%;max-width:260px;height:6px;background-color:#e1e4e8;border-radius:6px}.bar{display:flex;height:100%;background:linear-gradient(90deg,#ffd33d,#ea4aaa 10%,#b34bff 30%,#01feff 51%,#ffb33d 68%,#ea4aaa 85%,#b34bff);background-size:300% 100%;animation:bar 2s linear infinite}@keyframes bar{0%{background-position:100%}100%{background-position:0}}</style><body><div class="preload"><div class="text"><span>L</span> <span>o</span> <span>a</span> <span>d</span> <span>i</span> <span>n</span> <span>g</span> <span>.</span> <span>.</span> <span>.</span></div><div class="loading"><span class="bar"></span></div></div><script>let texts=document.querySelector('.text').querySelectorAll('span');let timer=setInterval(()=>{texts.forEach((item)=>{item.classList.toggle("dance")})},1700);window.onload=function(){clearInterval(timer);document.querySelector('.preload').style="display:none;"}</script><title>SHIWIVI-文章</title>
<link rel="stylesheet" href="https://at.alicdn.com/t/font_2856826_bu73u0ahu7a.css">

<link rel="stylesheet" href="/blog/css/index.css">
<link rel="stylesheet" href="/blog/css/article.css">
<link rel="stylesheet" href="/blog/css/atelier-cave.min.css">

<meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/blog/atom.xml" title="SHWIVI's blog" type="application/atom+xml">
</head>
<body>
<div class="nav">
    <div class="card">
        <div class="head">
            <img src="/blog/images/head.jpg"  alt="头不见了.." title="狗">
        </div>
        <div class="card-text">
            <p>(ー`´ー)</p>
            <p>那不是bug，是彩蛋</p>
        </div> 
    </div>
    <ul class="label">
        
        <li><a href="/blog/index.html">首页</a></li>
        
        <li><a href="/blog/life">日常</a></li>
        
        <li><a href="/blog/record">一句</a></li>
        
        <li><a href="/blog/message">留言</a></li>
        
        <li><a href="/blog/about">关于</a></li>
          
    </ul>
        <ul class="tag">
            <li><a href="/blog/tags/Command">#Command</a></li>
            <li>#Java</li>
            <li><a href="/blog/tags/Css">#Css</a></li>
            <li><a href="/blog/tags/Life">#Life</a></li>
            <li>#Lua</li>
            <li><a href="/blog/tags/PCB">#PCB</a></li>
            <li><a href="/blog/tags/Shell">#Shell</a></li>
            <li><a href="/blog/tags/C">#C</a></li>
            <li><a href="/blog/tags/html">#html</a></li>
            <li><a href="/blog/tags/%E7%A1%AC%E4%BB%B6">#硬件</a></li>
            <li><a href="/blog/tags/JavaScrip">#JavaScript</a></li>
            <li><a href="/blog/tags/Firewall">#Firewall</a></li>
            <li>#Security</li>
            <li><a href="/blog/tags/Linux">#Linux</a></li>
            <li>#Python</li>
            <li><a href="/blog/tags/Server">#Server</a></li>
            <li><a href="/blog/tags/Web">#Web</a></li>
        </ul>
    <div class="rsstag"><a href="/blog/atom.xml"><span class="iconfont icon-rss"></span>RSS订阅</a></div>
<div class="flower">
<?xml version="1.0" encoding="UTF-8"?>
<svg width="84.6px" height="70.5px" viewBox="0 0 254 212" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<title>窗</title>
<desc>Created with Sketch.</desc>
<defs></defs>
<g id="植物" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
    <g id="Artboard" transform="translate(-885.000000, -503.000000)">
        <g id="植物-紫色盆" transform="translate(882.000000, 500.000000)">
            <ellipse id="Oval-12" fill="#B3B7C7" cx="140.5" cy="137" rx="39.5" ry="6"></ellipse>
            <g id="Group-5">
                <path d="M131.5,149 C137.746054,149 138.400559,136.953074 140.297813,118.503702 C141.504079,106.77367 149.145158,88.1140929 147,75 C142.297813,46.2539062 153.271934,32.5660626 150.170125,19.4282488 C148.031314,10.3692495 142.862042,3 131.5,3 C123.603887,3 113.698654,6.59314895 110.722909,11.2157433 C103.206874,22.8913341 114,46.5137576 114,75 C114,90.4435309 122.495151,106.751425 123.699377,118.476362 C125.595832,136.941172 125.250862,149 131.5,149 Z" id="Oval-11" fill="#BAC4F6"></path>
                <path d="M135.5,146.5 C132.598908,121.877878 130.965369,104.566553 130.599381,94.5660242 C130.050399,79.5652312 132.963841,77.0580598 132.164069,55.3464601 C131.630888,40.8720602 130.242865,30.4232402 128,24" id="Line-15" stroke="#FFFFFF" stroke-width="2" opacity="0.800892857" stroke-linecap="square"></path>
                <path d="M77.0442201,163.336077 C84.2239219,163.336077 101.067658,131.237823 101.067658,92.025606 C101.067658,52.8133888 90.9057581,-2.32627732 72.6560979,17.2440872 C50.0508064,41.4852946 69.5871262,36.5862429 74.0442201,63.8595149 C75.572858,73.2133576 77.0442201,94.5993942 77.0442201,104.613421 C77.0442201,143.825638 69.8645184,163.336077 77.0442201,163.336077 Z" id="Oval-9" fill="#BAC4F6" transform="translate(81.510722, 88.251316) rotate(-43.000000) translate(-81.510722, -88.251316) "></path>
                <path d="M42.5,50.5 C47.5132933,48.8699207 59.3816332,57.6317857 78.1050199,76.785595 C96.8284065,95.9394043 113.960067,116.844206 129.5,139.5" id="Line-17" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M155.281006,152.144255 C162.116643,152.144255 178.153197,121.584207 178.153197,84.2511084 C178.153197,72.6051871 184.354199,51.8242671 182.531201,39.8465879 C178.51025,13.4276595 163.058175,0.233079666 151.10317,13.0532528 C129.581164,36.1327785 143.297279,29.7382802 147.540781,55.7045685 C148.996164,64.6101585 153.500382,80.3852665 153.500382,89.9194035 C153.500382,127.252502 148.445368,152.144255 155.281006,152.144255 Z" id="Oval-9-Copy-2" fill="#E9EDFD" transform="translate(161.092971, 80.123972) scale(-1, 1) rotate(-20.000000) translate(-161.092971, -80.123972) "></path>
                <path d="M180.5,34.5 C181.290102,21.4892162 175.746138,28.9223292 163.868108,56.7993391 C157.546037,71.6368512 150.532373,85.3308057 144.827114,101.881203 C141.023608,112.914801 138.581237,128.787733 137.5,149.5" id="Line-20" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M60.3426107,183.894782 C69.2498271,183.894782 90.1463498,156.072081 90.1463498,122.083011 C90.1463498,88.0939419 67.5408019,29.4364067 54.8986583,57.2625442 C45.0326912,78.978146 51.0912584,74.0282851 56.6207779,97.6687014 C58.5172227,105.776593 67.8616068,124.363423 67.8616068,133.043561 C67.8616068,167.032631 51.4353942,183.894782 60.3426107,183.894782 Z" id="Oval-9-Copy" fill="#BAC4F6" transform="translate(69.895982, 116.944107) rotate(-71.000000) translate(-69.895982, -116.944107) "></path>
                <path d="M24.5,109.5 C22.4991751,103.669523 35.0833631,105.49608 62.2525641,114.979669 C79.4278854,120.974828 92.103247,119.378882 106.278649,126.191831 C111.777518,128.834684 120.517968,134.937407 132.5,144.5" id="Line-19" stroke="#FFFFFF" stroke-width="2" opacity="0.595424107" stroke-linecap="square"></path>
                <path d="M169.495543,159.559977 C178.40276,159.559977 199.299282,131.737276 199.299282,97.7482062 C199.299282,85.7856682 202.004463,66.329956 197.824033,53.1018748 C190.126639,28.745108 172.2443,14.8950801 164.051591,32.9277389 C154.185624,54.6433407 160.244191,49.6934798 165.77371,73.3338961 C167.670155,81.4417878 177.014539,100.028618 177.014539,108.708756 C177.014539,142.697825 160.588327,159.559977 169.495543,159.559977 Z" id="Oval-9-Copy-3" fill="#BAC4F6" transform="translate(179.479352, 92.134636) scale(-1, 1) rotate(-43.000000) translate(-179.479352, -92.134636) "></path>
                <path d="M213.5,60.5 C209.183273,60.8948914 201.740861,65.4428024 191.172763,74.1437328 C175.320617,87.1951284 177.797205,83.2393994 161.560337,103.262986 C150.735758,116.612043 142.715646,131.024381 137.5,146.5" id="Line-21" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M81.1425752,168.630026 C85.1025169,165.536181 98.2051544,147.96348 98.2051544,111.236918 C98.2051544,74.5103552 86.0176544,46.7369177 70.0176544,46.7369177 C54.0176544,46.7369177 59.5351666,70.3889964 66.8400325,93.0530589 C69.6371249,101.731312 78.9791535,122.814465 81.0032985,132.88325 C84.2653955,149.110029 78.6989273,170.539213 81.1425752,168.630026 Z" id="Oval-10" fill="#E9EDFD" transform="translate(78.936475, 107.743055) rotate(-52.000000) translate(-78.936475, -107.743055) "></path>
                <path d="M39.5,84.5 C46.5402399,84.832105 55.9862242,87.7506309 67.8379528,93.2555776 C85.6155457,101.512998 79.9127462,96.6348296 100.298442,112.739947 C113.888906,123.476691 125.956092,135.063376 136.5,147.5" id="Line-18" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M194.823347,177.534556 C197.785465,175.220296 209.085075,165.125173 213.530819,146.109724 C215.496552,137.701844 211.555235,124.000271 211.555235,111.853141 C211.555235,72.2337887 199.639103,43.8487815 182.378853,43.8487815 C165.118604,43.8487815 168.053621,58.2764613 175.933859,82.7256721 C183.814096,107.174883 191.693317,118.61017 193.876895,129.472028 C197.395933,146.976919 192.187224,179.594121 194.823347,177.534556 Z" id="Oval-10-Copy-2" fill="#E9EDFD" transform="translate(191.881132, 110.738214) scale(-1, 1) rotate(-52.000000) translate(-191.881132, -110.738214) "></path>
                <path d="M237.5,84.5 C231.839918,82.6252532 222.387737,84.7837206 209.143456,90.9754021 C189.277034,100.262925 198.344222,96.9653923 174.587666,113.911421 C158.749962,125.208774 147.387407,137.071634 140.5,149.5" id="Line-22" stroke="#FFFFFF" stroke-width="2" opacity="0.785044643" stroke-linecap="square"></path>
                <path d="M102.095097,154.049614 C106.979303,150.233654 123.140143,128.559423 123.140143,83.2607523 C123.140143,37.9620813 108.108037,3.70622602 88.3735811,3.70622602 C68.639125,3.70622602 75.4444439,32.8787829 84.4542911,60.8327171 C87.9042347,71.5365054 99.4267255,97.5405402 101.923313,109.959415 C105.946795,129.97358 99.0810936,156.404412 102.095097,154.049614 Z" id="Oval-10-Copy" fill="#E9EDFD" transform="translate(99.374086, 78.951409) rotate(-21.000000) translate(-99.374086, -78.951409) "></path>
                <path d="M70.5,27.5 C77.9697854,36.2141564 84.664658,44.2949462 90.5846178,51.7423694 C99.4645574,62.9135043 102.309139,65.8595669 108.078018,74.773869 C113.846897,83.6881711 108.232283,69.1486166 118.500716,94.8794382 C125.346337,112.033319 129.012765,128.573507 129.5,144.5" id="Line-16" stroke="#FFFFFF" stroke-width="2" stroke-linecap="square"></path>
                <path d="M193.001521,189.153265 C198.929205,189.153265 212.83568,162.652399 212.83568,130.278124 C212.83568,97.9038493 204.210737,49.7003434 189.378612,68.5372278 C174.540517,87.3816949 180.150684,86.5530431 183.830536,109.070321 C185.092606,116.793013 193.001521,132.403088 193.001521,140.670839 C193.001521,173.045114 187.073837,189.153265 193.001521,189.153265 Z" id="Oval-9-Copy-4" fill="#BAC4F6" transform="translate(196.248002, 126.727326) scale(-1, 1) rotate(-73.000000) translate(-196.248002, -126.727326) "></path>
                <path d="M234.5,116.5 C229.435614,115.997419 220.043174,117.148484 206.322678,119.953197 C185.741934,124.160265 185.201799,123.9696 168.145826,131.063968 C156.775178,135.793546 148.226569,140.93889 142.5,146.5" id="Line-23" stroke="#FFFFFF" stroke-width="2" opacity="0.733426339" stroke-linecap="square"></path>
            </g>
            <g id="Group-4" transform="translate(101.000000, 137.000000)">
                <path d="M0,0 C11.7955729,2 24.5052083,3 38.1289062,3 C51.7526042,3 65.3763021,2 79,0 L71.2109375,75.3409091 C61.9375,77.1136364 51.8945312,78 41.0820312,78 C30.2695313,78 19.4570312,77.1136364 8.64453125,75.3409091 L0,0 Z" id="Rectangle-9" fill="#FCDCCF"></path>
                <path d="M59.2621996,2.19791001 C63.6483775,1.86496527 70.2276443,1.1323286 79,0 L71.2109375,75.3409091 C63.3055851,76.5844933 57.2271178,77.3450382 52.9755357,77.6225437 L59.2621996,2.19791001 Z" id="Rectangle-9" fill="#ECC6B6"></path>
                <path d="M0,0 C10.9588352,1.33333333 23.3572727,2 37.1953125,2 C51.0333523,2 64.9682481,1.33333333 79,0 L76.7909585,21.3672948 L40.573652,23.0934676 L2.38711382,20.8047516 L0,0 Z" id="Rectangle-9" fill="#F3B096"></path>
            </g>
        </g>
    </g>
</g>
</svg>
</div>

</div>
<div class="menu-btn closed"> 
    <div class="menu-line"></div>
    <div class="menu-line"></div>
    <div class="menu-line"></div>
</div>
<div class="main">
    <div class="msg">
        <div class="msg-text"></div>
        <div class="msg-bar"></div>
    </div>
    <div class="motto">
        <p> //sunny forever<br />
            while(life&lt;end){<br />
               love++;<br />
               beAwesome :)} </p>
     </div>
     <div class="main-content">
    <div class="set-wrapper">
    <ul class="set-menu">
        <div id="set-btn" class="set-button"><</div>
        <li class="search-container">
            <input id="search-input" class="local-search" placeholder="搜索..." type="search" >
            <span class="search-ico"></span>
        </li>
        <li id="toggle-theme">
        主题：<span class="theme-ico sun"></span>
        </li>
        <li class="set-size">
            <span id="increase-font-size">+</span>
            <span class="font-size-num"></span>
            <span id="reduce-font-size">-</span>
        </li>
        <li id="clear-back">清除背景</li>
        <li id="disable-back">禁用背景</li>
    </ul> 
</div>
    <div class="result-container">
        <div id="search-result" class="display-result"></div>
    </div>
    <div class="toc-wrapper"><div class="toc-btn">目 录</div><div class="toc-box"><!--tocBox用于容纳生成在toc外的目录--><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#proc%E7%9B%AE%E5%BD%95"><span class="toc-number">1.</span> <span class="toc-text">proc目录</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#proc-lt-pid-gt"><span class="toc-number">1.1.</span> <span class="toc-text">&#x2F;proc&#x2F;&lt;pid&gt;</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.1.</span> <span class="toc-text">基本信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%8A%B6%E6%80%81%E4%B8%8E%E8%B5%84%E6%BA%90"><span class="toc-number">1.1.2.</span> <span class="toc-text">进程状态与资源</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E4%BD%99%E9%83%A8%E5%88%86%E5%AD%90%E6%96%87%E4%BB%B6%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">其余部分子文件的作用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E4%BF%A1%E6%81%AF"><span class="toc-number">1.2.1.</span> <span class="toc-text">硬件信息</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.2.</span> <span class="toc-text">内核参数与配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86"><span class="toc-number">2.</span> <span class="toc-text">进程管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ps%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">ps查看进程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pstree%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E6%A0%91"><span class="toc-number">2.2.</span> <span class="toc-text">pstree查看进程树</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pgrep%E5%BF%AB%E9%80%9F%E6%9F%A5%E6%89%BEPID"><span class="toc-number">2.3.</span> <span class="toc-text">pgrep快速查找PID</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lsof%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E8%B0%83%E7%94%A8%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">2.4.</span> <span class="toc-text">lsof查看进程调用的文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#top%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90%E5%8D%A0%E7%94%A8%E7%8A%B6%E6%80%81"><span class="toc-number">2.5.</span> <span class="toc-text">top监控系统资源占用状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#vmstat%E6%8C%89%E6%8C%87%E5%AE%9A%E6%AC%A1%E6%95%B0%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90"><span class="toc-number">2.6.</span> <span class="toc-text">vmstat按指定次数监控系统资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#free%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98%E4%BF%A1%E6%81%AF"><span class="toc-number">2.7.</span> <span class="toc-text">free查看内存信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%AD%E6%AD%A2%E8%BF%9B%E7%A8%8B"><span class="toc-number">2.8.</span> <span class="toc-text">中止进程</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E4%BF%A1%E5%8F%B7"><span class="toc-number">2.8.1.</span> <span class="toc-text">系统信号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#kill%E5%90%91%E8%BF%9B%E7%A8%8B%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">2.8.2.</span> <span class="toc-text">kill向进程发送信号</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#killall%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.3.</span> <span class="toc-text">killall命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pkill%E5%91%BD%E4%BB%A4"><span class="toc-number">2.8.4.</span> <span class="toc-text">pkill命令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98"><span class="toc-number">3.</span> <span class="toc-text">虚拟内存</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98"><span class="toc-number">3.1.</span> <span class="toc-text">创建虚拟内存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mkswap%E8%AE%BE%E7%BD%AE%E4%BA%A4%E6%8D%A2%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">mkswap设置交换文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#swapon-swapoff-%E5%90%AF%E7%94%A8-%E7%A6%81%E7%94%A8%E4%BA%A4%E6%8D%A2%E7%A9%BA%E9%97%B4"><span class="toc-number">3.3.</span> <span class="toc-text">swapon&#x2F;swapoff 启用&#x2F;禁用交换空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#proc-swaps-%E6%96%87%E4%BB%B6"><span class="toc-number">3.4.</span> <span class="toc-text">&#x2F;proc&#x2F;swaps 文件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E7%AE%A1%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">工作管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E7%A8%8B%E5%BA%8F%E8%BD%AC%E5%85%A5%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C-%E6%9A%82%E5%81%9C"><span class="toc-number">4.1.</span> <span class="toc-text">将程序转入后台运行&#x2F;暂停</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jobs%E6%9F%A5%E7%9C%8B%E5%90%8E%E5%8F%B0%E7%9A%84%E5%B7%A5%E4%BD%9C"><span class="toc-number">4.2.</span> <span class="toc-text">jobs查看后台的工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E7%A4%BA%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%96%B9%E6%B3%95jobspec"><span class="toc-number">4.3.</span> <span class="toc-text">表示任务的方法jobspec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#fg%E5%B0%86%E5%90%8E%E5%8F%B0%E6%9A%82%E5%81%9C%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%81%A2%E5%A4%8D%E5%88%B0%E5%89%8D%E5%8F%B0%E6%89%A7%E8%A1%8C"><span class="toc-number">4.4.</span> <span class="toc-text">fg将后台暂停的工作恢复到前台执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bg%E5%B0%86%E5%90%8E%E5%8F%B0%E6%9A%82%E5%81%9C%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%81%A2%E5%A4%8D%E5%88%B0%E5%90%8E%E5%8F%B0%E6%89%A7%E8%A1%8C"><span class="toc-number">4.5.</span> <span class="toc-text">bg将后台暂停的工作恢复到后台执行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#disown%E5%B0%86%E5%90%8E%E5%8F%B0%E4%BB%BB%E5%8A%A1%E4%BB%8E%E7%BB%88%E7%AB%AFjobs%E4%BB%BB%E5%8A%A1%E5%88%97%E8%A1%A8%E7%A7%BB%E9%99%A4"><span class="toc-number">4.6.</span> <span class="toc-text">disown将后台任务从终端jobs任务列表移除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#chroot%E6%8C%87%E5%AE%9A%E6%96%B0%E6%A0%B9%E7%9B%AE%E5%BD%95%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.7.</span> <span class="toc-text">chroot指定新根目录并运行命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#env%E5%9C%A8%E4%BF%AE%E6%94%B9%E5%90%8E%E7%9A%84%E7%8E%AF%E5%A2%83%E4%B8%AD%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.8.</span> <span class="toc-text">env在修改后的环境中运行命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nohub%E9%80%80%E5%87%BA%E7%BB%88%E7%AB%AF%E6%97%B6%E7%BB%A7%E7%BB%AD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.9.</span> <span class="toc-text">nohub退出终端时继续执行命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#setsid%E5%9C%A8%E6%96%B0%E4%BC%9A%E8%AF%9D%E4%B8%AD%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">4.10.</span> <span class="toc-text">setsid在新会话中执行命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#timeout%E9%99%90%E5%88%B6%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="toc-number">4.11.</span> <span class="toc-text">timeout限制命令执行时间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B0%83%E6%95%B4%E8%B0%A6%E8%AE%A9%E5%BA%A6"><span class="toc-number">4.12.</span> <span class="toc-text">调整谦让度</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#nice%E6%8C%87%E5%AE%9A%E8%B0%83%E5%BA%A6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.12.1.</span> <span class="toc-text">nice指定调度优先级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#renice%E4%BF%AE%E6%94%B9%E8%B0%83%E5%BA%A6%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.12.2.</span> <span class="toc-text">renice修改调度优先级</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#stdbuf%E8%B0%83%E6%95%B4%E5%91%BD%E4%BB%A4%E7%9A%84I-O%E7%BC%93%E5%86%B2"><span class="toc-number">4.13.</span> <span class="toc-text">stdbuf调整命令的I&#x2F;O缓冲</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">服务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.1.</span> <span class="toc-text">服务查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-RPM%E5%8C%85%E5%AE%89%E8%A3%85%E7%9A%84%E5%BA%94%E7%94%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.1.</span> <span class="toc-text">1. RPM包安装的应用服务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%BA%90%E7%A0%81%E5%8C%85%E5%AE%89%E8%A3%85%E7%9A%84%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.1.2.</span> <span class="toc-text">2. 源码包安装的服务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RPM%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.2.</span> <span class="toc-text">RPM服务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.2.1.</span> <span class="toc-text">独立服务管理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E5%91%BD%E4%BB%A4"><span class="toc-number">5.2.2.</span> <span class="toc-text">独立服务命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%8B%AC%E7%AB%8B%E6%9C%8D%E5%8A%A1%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">5.2.3.</span> <span class="toc-text">独立服务自启动</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Exinetd-%E8%B6%85%E7%BA%A7%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B-%E6%9C%8D%E5%8A%A1"><span class="toc-number">5.2.4.</span> <span class="toc-text">基于xinetd(超级守护进程)服务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%8C%85%E5%AE%89%E8%A3%85%E7%9A%84%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">5.3.</span> <span class="toc-text">源码包安装的服务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8"><span class="toc-number">5.3.1.</span> <span class="toc-text">服务启动</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">5.3.2.</span> <span class="toc-text">自启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%BC%80%E6%9C%BA%E6%97%B6%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E9%A1%BA%E5%BA%8F"><span class="toc-number">5.4.</span> <span class="toc-text">查看开机时服务启动顺序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#alternatives%E5%B7%A5%E5%85%B7"><span class="toc-number">6.</span> <span class="toc-text">alternatives工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#alternatives%E7%AE%80%E4%BB%8B"><span class="toc-number">6.1.</span> <span class="toc-text">alternatives简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#alternatives%E5%91%BD%E4%BB%A4"><span class="toc-number">6.2.</span> <span class="toc-text">alternatives命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E7%BB%84"><span class="toc-number">6.2.1.</span> <span class="toc-text">注册组</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">6.2.2.</span> <span class="toc-text">其他命令</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">6.3.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%B3%A8%E5%86%8C%E7%BB%84"><span class="toc-number">6.3.1.</span> <span class="toc-text">1. 注册组</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.</span> <span class="toc-text">定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#at%E5%91%BD%E4%BB%A4"><span class="toc-number">7.1.</span> <span class="toc-text">at命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2at%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.1.1.</span> <span class="toc-text">查询at定时任务</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A0%E9%99%A4at%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.1.2.</span> <span class="toc-text">删除at定时任务</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#crond%E6%9C%8D%E5%8A%A1"><span class="toc-number">7.2.</span> <span class="toc-text">crond服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bcrond%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C%E6%83%85%E5%86%B5"><span class="toc-number">7.2.1.</span> <span class="toc-text">查看crond服务运行情况</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Bcrond%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">7.2.2.</span> <span class="toc-text">查看crond服务是否开机自启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEcrond%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">7.3.</span> <span class="toc-text">设置crond定时任务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#cron%E8%AF%AD%E6%B3%95"><span class="toc-number">7.3.1.</span> <span class="toc-text">cron语法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%9C%8D%E5%8A%A1"><span class="toc-number">8.</span> <span class="toc-text">日志服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#rsyslog%E6%9C%8D%E5%8A%A1"><span class="toc-number">8.1.</span> <span class="toc-text">rsyslog服务</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2rsyslog%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E5%9C%A8%E8%BF%90%E8%A1%8C"><span class="toc-number">8.1.1.</span> <span class="toc-text">查询rsyslog服务是否在运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8Brsyslog%E6%9C%8D%E5%8A%A1%E6%98%AF%E5%90%A6%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8"><span class="toc-number">8.1.2.</span> <span class="toc-text">查看rsyslog服务是否开机自启动</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">8.2.</span> <span class="toc-text">日志文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsyslog%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-number">8.3.</span> <span class="toc-text">rsyslog日志格式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rsyslog%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">8.4.</span> <span class="toc-text">rsyslog日志配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%90%8D"><span class="toc-number">8.4.1.</span> <span class="toc-text">服务名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%AC%A6"><span class="toc-number">8.4.2.</span> <span class="toc-text">连接符</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E7%AD%89%E7%BA%A7"><span class="toc-number">8.4.3.</span> <span class="toc-text">日志等级</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E4%BD%8D%E7%BD%AE"><span class="toc-number">8.4.4.</span> <span class="toc-text">日志记录位置</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">8.4.5.</span> <span class="toc-text">示例</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%BD%AE%E6%9B%BF"><span class="toc-number">8.5.</span> <span class="toc-text">日志轮替</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9"><span class="toc-number">8.5.1.</span> <span class="toc-text">配置文件内容</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E8%BD%AE%E6%9B%BF"><span class="toc-number">8.5.2.</span> <span class="toc-text">手动进行日志轮替</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E4%B8%8E%E6%81%A2%E5%A4%8D"><span class="toc-number">9.</span> <span class="toc-text">备份与恢复</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">9.1.</span> <span class="toc-text">备份</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E9%9C%80%E5%A4%87%E4%BB%BD%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">9.1.1.</span> <span class="toc-text">一般需备份的数据</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dump%E6%96%87%E4%BB%B6%E5%A4%87%E4%BB%BD%E7%B3%BB%E7%BB%9F"><span class="toc-number">9.2.</span> <span class="toc-text">dump文件备份系统</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%AE%89%E8%A3%85dump"><span class="toc-number">9.2.1.</span> <span class="toc-text">1. 安装dump</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-dump%E5%91%BD%E4%BB%A4"><span class="toc-number">9.2.2.</span> <span class="toc-text">2. dump命令</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E5%A4%87%E4%BB%BD%E6%93%8D%E4%BD%9C"><span class="toc-number">9.2.3.</span> <span class="toc-text">3.备份操作</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#restore%E8%BF%98%E5%8E%9Fdump%E5%A4%87%E4%BB%BD%E7%9A%84%E6%96%87%E4%BB%B6"><span class="toc-number">9.3.</span> <span class="toc-text">restore还原dump备份的文件</span></a></li></ol></li></ol></div></div>
        <div class="article">
        <h1 class="title">Linux服务与系统资源管理</h1>
        <div class="art-info">
            <div><span><span class="iconfont icon-zishu-jzl"></span>字数：30240</span>
            <span><span class="iconfont icon-riqi"></span>写于：2021-12-29</span></div>
            <div><span><span class="iconfont icon-zuixinnew3"></span>最新更新：2022-01-20</span>
            <span><span class="iconfont icon-shijian"></span>阅读本文预计花费您87分钟</span></div>
        </div>
        <div class="art-content">
        <h3 id="proc目录"><a href="#proc目录" class="headerlink" title="proc目录"></a>proc目录</h3><p><span class="strong">/proc</span>目录是由Linux内核生成的虚拟文件目录，用来向用户以文件形式提供一种动态访问内核数据和系统信息的接口，，该目录下的大部分文件大小通常显示为0(占用内存空间)，文件内容随着系统状态实时变化，在读取时会实时返回数据。该目录下大部分文件内容的字段分隔符为<span class="strong">NUL字符\0</span>，因此在读取文件内容时推荐使用命令<span class="text-red">cat 文件名 | tr ‘\000’ ‘ ‘</span>来使用空格替换\0</p>
<h4 id="proc-lt-pid-gt"><a href="#proc-lt-pid-gt" class="headerlink" title="/proc/&lt;pid&gt;"></a>/proc/&lt;pid&gt;</h4><p>在proc目录下，每个正在运行的进程都有一个以pid为目录名的伪文件系统目录，里面包含了一些进程相关的文件，以下是部分文件包含的信息：</p>
<h5 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h5><ul>
<li><span class="strong">cmdline</span>启动该进程时的完整命令行参数，内容以NUL字符分隔</li>
<li><span class="strong">comm</span>进程的命令名，最多显示16字节</li>
<li><span class="strong">environ</span>进程的环境变量，内容以NUL字符分隔</li>
<li><span class="strong">cwd</span>符号链接，指向进程的当前工作目录</li>
<li><span class="strong">exe</span>符号链接，指向正在运行的可执行文件</li>
<li><span class="strong">root</span>符号链接，进程所看到的根目录，受chroot影响</li>
</ul>
<div class="show">以饥荒联机版进程为例
1. cat cmdline | tr '\0' ' '
./dontstarve_dedicated_server_nullrenderer_x64 -console -persistent_storage_root /home/steam/klei -conf_dir DST -cluster Cluster_18 -shard Master
2.cat comm | tr '\0' ' '
dontstarve_dedi
3.ls -l cwd
lrwxrwxrwx 1 steam steam 0 Aug 19 05:18 cwd -> /home/steam/steamapps/DST/data
4.readlink exe 
/home/steam/steamapps/DST/bin64/dontstarve_dedicated_server_nullrenderer_x64
</div>

<h5 id="进程状态与资源"><a href="#进程状态与资源" class="headerlink" title="进程状态与资源"></a>进程状态与资源</h5><ul>
<li><span class="strong">status</span>以人类可读形式显示进程信息，包括大部分stat文件和statm文件的信息，包括：<blockquote>
<blockquote>
<ul>
<li>Name：进程名，最长显示16个字符</li>
<li>Umask：该进程创建文件或目录时的umask值</li>
<li>State：进程状态（R运行、S睡眠、Z僵尸、D磁盘睡眠、T进程暂停、t停止追踪、X终止）</li>
<li>Tgid,Ngid,Pid,PPid,TracerPid：分别为线程组ID，命名空间组ID(Namespace Group ID，在非命名空间环境中为0)，进程ID，父进程ID，追踪此进程的进程ID(如果没有则为0)</li>
<li>Uid,Gid：一共有4个字段，分别表示RUID(Real UID，进程实际启动者/拥有者)、EUID(Effective UID，进程当前拥有的权限，可以通过setuid设置临时提权，如：执行passwd命令将拥有root权限)、SUID(Saved UID，保存初始的 EUID，用于权限恢复)、FSUID(Filesystem UID，用于读写文件时文件系统访问权限检查),Gid类似</li>
<li>FDSize:进程可以打开的文件描述符数量上限</li>
<li>Groups:进程所属的附加组ID</li>
<li>NStgid,NSpid,NSpgid,NSsid:分别表示进程在各PID命名空间中的线程组ID,线程ID,进程组ID,会话ID，主要用于容器技术</li>
<li>Kthread：进程是否是内核线程(1是，0否)</li>
<li>VmPeak,VmSize,VmLck,VmPin,VmHWM,VmRSS：分别表示进程启动以来所占用的虚拟内存峰值，当前占用虚拟内存总量，进程锁定的物理内存(不会被交换到swap)，进程固定的物理内存，进程自启动以来占用的物理内存峰值，进程当前占用的物理内存(不包括swap)</li>
<li>RssAnon,RssFile,RssShmem：进程占用的匿名内存，进程占用的文件映射内存的物理内存大小，进程占用的共享内存的物理内存大小</li>
<li>VmData,VmStk,VmExe,VmLib,VmPTE,VmSwap：进程数据段占用的虚拟内存大小，进程栈占用的虚拟内存大小，进程可执行代码占用的虚拟内存大小，进程加载的共享库占用的虚拟内存大小，进程页表项(管理虚拟内存映射的开销)占用的内存大小，进程被交换到 Swap 分区 的内存大小</li>
<li>更多信息参考文档</li>
</ul>
</blockquote>
</blockquote>
</li>
<li><span class="strong">stat</span>:类似于status文件，包含大量进程信息，一共有52个字段，每个字段空格分隔，该文件不会标注每个字段的含义，因此适合脚本分析，这些字段依次代表：进程ID、可执行文件名(括号包裹以避免文件名本身包含空格)、进程状态、父进程ID、进程组ID、会话ID、进程所连接的tty的设备号(没有则为0)，前台进程组ID(与tty关联)，进程的任务标志，进程累计的次缺页数，子进程的次缺页数，该进程累计的主缺页数，子进程的主缺页数，进程在用户态运行的时间(单位jiffies)，进程在内核态运行的时间（单位 jiffies），已死去子进程的用户态时间总和，已死去子进程的内核态时间总和，动态优先级(不是nice值，内核内部特有表示方法，通常是20+nice)，nice值，线程数，itrealvalue(已废弃始终为0)，进程启动时间(单位jiffies，进程在自系统启动以来n个tick数时启动)，虚拟内存大小(字节)，驻留内存页数，内存使用上限(字节)，程序可执行代码段的起始地址，程序可执行代码段的结束地址，栈的起始地址，当前 ESP（内核栈指针），当前 EIP（指令指针），待处理信号的位图，被屏蔽的信号位图，被忽略的信号位图，被捕捉的信号位图，进程在睡眠时的内核函数地址，已换出的页数，子进程换出的页数，线程在退出时向父进程发送的信号，最后执行该进程的CPU核心号，实时优先级（0表示普通进程），调度策略，在等待IO完成时消耗的时间，客户CPU时间，子进程的客户CPU时间，数据段起始地址，数据段结束地址，brk系统调用堆的起始地址，命令行参数起始地址，命令行参数结束地址，环境变量起始地址，环境变量结束地址，进程的退出代码</li>
<li><span class="strong">statm</span>：进程内存使用情况</li>
<li><span class="strong">limits</span>：进程当前的资源限制，比如最大打开文件数、最大堆栈大小等</li>
<li><span class="strong">sched</span>：调度器相关信息（调度策略、优先级、时间片消耗等）</li>
<li><span class="strong">io</span>：进程的 I/O 统计信息，比如读写的字节数</li>
<li><span class="strong">maps</span>：显示进程的内存映射情况</li>
<li><span class="strong">mem</span>：进程虚拟内存，可以用来读写进程内存</li>
<li><span class="strong">fd目录</span>：包含指向进程打开的所有文件描述符的符号链接</li>
<li><span class="strong">task目录</span>：该进程下所有线程的子目录，每个线程有类似 /proc/&lt;tid&gt;的结构</li>
<li><span class="strong">mounts</span>:进程看到的挂载点信息</li>
<li><span class="strong">cgroup</span>:进程所属的 cgroup 信息</li>
</ul>
<h4 id="其余部分子文件的作用"><a href="#其余部分子文件的作用" class="headerlink" title="其余部分子文件的作用"></a>其余部分子文件的作用</h4><h5 id="硬件信息"><a href="#硬件信息" class="headerlink" title="硬件信息"></a>硬件信息</h5><ul>
<li><span class="strong">cpuinfo</span>CPU 详细信息（型号、核心数等）</li>
<li><span class="strong">meminfo</span>内存使用情况（总量、空闲、缓存等）</li>
<li><span class="strong">partitions</span>磁盘分区信息</li>
<li><span class="strong">mounts</span>已挂载的文件系统</li>
</ul>
<h5 id="内核参数与配置"><a href="#内核参数与配置" class="headerlink" title="内核参数与配置"></a>内核参数与配置</h5><ul>
<li><span class="strong">sys目录</span>该目录下包含一些可修改的系统参数文件(可以使用sysctl命令修改或直接修改文件)，如：/proc/sys/kernel/hostname用来修改主机名</li>
<li><span class="strong">version</span>内核版本和编译信息</li>
<li><span class="strong">uptime</span>第一个字段为系统总运行时间(秒)，第二个字段为CPU空闲时间(秒)</li>
<li><span class="strong">interrupts</span>中断请求统计</li>
<li><span class="strong">modules</span>已加载的内核模块</li>
</ul>
<h3 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h3><h4 id="ps查看进程"><a href="#ps查看进程" class="headerlink" title="ps查看进程"></a>ps查看进程</h4><p>该命令来自<span class="tips">procps-ng</span>包</p>
<ol>
<li><span class="strong">ps aux</span>&emsp;使用BSD(unix)标准格式显示进程</li>
</ol>
<ul>
<li>a &emsp;显示所有前台进程</li>
<li>x &emsp;显示所有后台进程</li>
<li>u &emsp;显示进程由哪个用户产生</li>
</ul>
<div class="show">BSD格式的进程信息：
USER：该进程由哪个用户产生
PID：进程的ID号
%CPU：进程占用的CPU百分比
%MEM：进程占用的物理内存百分比
VSZ：进程占用的虚拟内存，单位为KB
RSS：进程占用的物理内存大小，单位为KB
TTY：进程在哪个终端运行，？为由Linux系统运行，tty1-tty6为本地字符界面终端，tty7为图形终端，pts/0-255为远程登录虚拟终端
STAT：进程状态，常见的状态字符有：R运行(runnable)，S睡眠(sleeping)，s包含子进程，+位于后台的进程组，T停止，&lt;优先级高的进程，N优先级低的进程，l多线程，Z僵尸进程，D无法中断的休眠进程(通常为IO进程)
START：进程启动时间
TIME：进程占用CPU时间
COMMAND：产生进程的命令名
</div>
2. <span class="strong">ps -le</span>&emsp;使用Linux标准格式显示进程

<ul>
<li>-l &emsp;显示详细信息</li>
<li>-e &emsp;显示所有进程</li>
<li>-C命令&emsp;显示指定命令的状态</li>
</ul>
<div class="show">Linux格式的进程信息：
UID：产生进程的用户ID
PID：进程的ID号
PPID：父进程ID
C：进程占用CPU百分比
STIME：进程启动时间
TTY：进程在哪个终端运行，参数同上
CMD：产生进程的命令名
</div>

<h4 id="pstree查看进程树"><a href="#pstree查看进程树" class="headerlink" title="pstree查看进程树"></a>pstree查看进程树</h4><p><span class="strong">pstree [选项]</span></p>
<ul>
<li>-p &emsp;显示进程PID</li>
<li>-u &emsp;显示进程所属用户</li>
</ul>
<h4 id="pgrep快速查找PID"><a href="#pgrep快速查找PID" class="headerlink" title="pgrep快速查找PID"></a>pgrep快速查找PID</h4><p><span class="strong">pgrep [选项] 进程名(可以使用正则表达式)</span></p>
<ul>
<li>默认情况下，命令只返回进程PID(适合在脚本中使用)，默认匹配方式为部分匹配(sh会匹配到sh、sshd、bash等)，精确匹配请使用-x，普通用户仅能匹配属于自己的进程，root可以匹配所有进程</li>
<li>-l 同时输出进程名和PID</li>
<li>-u 用户名：按用户名过滤进程</li>
<li>-x 精确匹配完整进程名</li>
<li>-f 匹配完整的命令行，包括命令路径、参数</li>
<li>-n 只显示最新的进程</li>
<li>-o 只显示最旧的进程</li>
<li>-c 返回匹配的进程数量，不显式PID</li>
<li>-d 分隔符：指定输出信息的分隔符，默认为换行符</li>
<li>-i 忽略大小写</li>
</ul>
<div class="show">1.默认情况下，pgrep匹配的是子字符串，如：
pgrep -l sh
会返回所有包含sh字符的进程
411580 sh
2134431 sshd
2134523 bash
...
2.使用-f可以匹配完整的命令路径、参数，但比默认匹配略慢
pgrep -f "/usr/sbin/sshd -D" 
</div>

<h4 id="lsof查看进程调用的文件"><a href="#lsof查看进程调用的文件" class="headerlink" title="lsof查看进程调用的文件"></a>lsof查看进程调用的文件</h4><p><span class="strong">lsof [选项]</span></p>
<ul>
<li>-c 字符串 &emsp;只列出以字符串开头的进程打开的文件</li>
<li>-u 用户名 &emsp;只列出某个用户所启动进程打开的文件</li>
<li>-p pid   &emsp;只列出某个PID进程打开的文件</li>
</ul>
<h4 id="top监控系统资源占用状态"><a href="#top监控系统资源占用状态" class="headerlink" title="top监控系统资源占用状态"></a>top监控系统资源占用状态</h4><p><span class="strong">top [选项]</span></p>
<ul>
<li>-d 秒数:指定每几秒更新系统状态，默认是3秒</li>
<li>-n 次数:在刷新指定次数后退出</li>
<li>-b 批处理模式，通常用来将输出写入文件或交给其他程序处理，top会一次性输出信息，通常搭配-d和-n使用</li>
<li>-p pid1,pid2…:查看指定进程的资源使用情况</li>
<li>-u 用户名或ID:查看用户名下进程的资源使用情况</li>
<li>-</li>
<li>-H 显示线程而非进程资源，可以在运行后按H切换</li>
<li>-c 显示进程的完整调用命令，而仅非名称，top执行后可以按c切换两种显示方式</li>
<li>-i 忽略闲置(idle)和僵尸(zombie)进程</li>
<li>-o %字段名：按字段名排序显示的信息，如 %CPU、%MEM、RES 等</li>
<li><span class="strong">在运行时切换信息显示方式：</span><blockquote>
<ul>
<li>?或h 显示交互帮助</li>
<li>P  根据CPU占用率显示进程顺序，默认</li>
<li>M  根据内存占用率显示进程顺序</li>
<li>N  根据PID显示进程顺序</li>
<li>q  退出top监控</li>
</ul>
</blockquote>
</li>
</ul>
<div class="shell">系统资源显示信息：
top - 15:40:11 up 41 days, 15:45,  2 users,  load average: 0.04, 0.05, 0.01
Tasks:  78 total,   1 running,  45 sleeping,   0 stopped,   0 zombie
%Cpu(s):  0.2 us,  0.2 sy,  0.0 ni, 99.6 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st
KiB Mem :   492280 total,    15964 free,    74408 used,   401908 buff/cache
KiB Swap:        0 total,        0 free,        0 used.   375944 avail Mem

<p>PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND<br>  1 root      20   0   51704   4948   3660 S  0.0  1.0  10:45.34 systemd</p>
</div>

<div class="table" style="text-align:left;">

<table>
<thead>
<tr>
<th align="left">内容</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">15:40:11</td>
<td align="left">系统当前时间</td>
</tr>
<tr>
<td align="left">up 41 days,15:45</td>
<td align="left">系统运行时间，已运行41天15小时45分</td>
</tr>
<tr>
<td align="left">2 users</td>
<td align="left">当前登录用户数量</td>
</tr>
<tr>
<td align="left">load average: 0.04, 0.05, 0.01</td>
<td align="left">系统在1分钟、5分钟、15分钟前的平均负载，根据主机内核数量判断负荷情况，如 8核，超过8表明已超负荷运行</td>
</tr>
<tr>
<td align="left">Tasks</td>
<td align="left">Tasks后分别为 系统中的总进程数、正在运行的进程、睡眠进程、停止的进程、僵尸进程</td>
</tr>
<tr>
<td align="left">%Cpu(s)</td>
<td align="left">us为CPU被用户占用的比率，sy为系统占用比例，ni为修改过优先级的用户进程CPU占用比率，id为CPU空闲的比率，wa为等待输入、输出的进程占用CPU的比率，hi为硬中断请求服务占用CPU比率，si为软中断请求服务占用CPU比率，st为有虚拟机时，虚拟CPU等待实际CPU的时间百分比</td>
</tr>
<tr>
<td align="left">Mem</td>
<td align="left">物理内存总大小、空闲内存大小、使用内存大小、正在缓冲的内存大小</td>
</tr>
<tr>
<td align="left">Swap</td>
<td align="left">交换分区总大小、空闲部分、使用部分、有效大小</td>
</tr>
</tbody></table>
</div>

<h4 id="vmstat按指定次数监控系统资源"><a href="#vmstat按指定次数监控系统资源" class="headerlink" title="vmstat按指定次数监控系统资源"></a>vmstat按指定次数监控系统资源</h4><p><span class="strong">vmstat 刷新延迟 监听次数</span></p>
<p>输出进程数、内存状态、交换分区状况、硬盘输入输出状况、CPU状态</p>
<div class="show"># vmstat 3 4
每3秒监听一次系统资源，输出4次</div>

<h4 id="free查看内存信息"><a href="#free查看内存信息" class="headerlink" title="free查看内存信息"></a>free查看内存信息</h4><p><span class="strong">free [参数]</span></p>
<ul>
<li>-b &emsp;以字节单位显示内存大小</li>
<li>-k &emsp;以KB单位显示内存大小(默认)</li>
<li>-m &emsp;以MB单位显示内存大小</li>
<li>-g &emsp;以GB单位显示内存大小</li>
</ul>
<h4 id="中止进程"><a href="#中止进程" class="headerlink" title="中止进程"></a>中止进程</h4><h5 id="系统信号"><a href="#系统信号" class="headerlink" title="系统信号"></a>系统信号</h5><p><span class="strong">kill -l</span>查询可用的进程信号(选项为L的小写字母非I)</p>
<p>Linux定义了64种信号，这些信号可由用户发起，也可由操作系统发起，信号在使用时可以使用其编号，也可以使用其名称，也可以是去除了<span class="tips">SIG</span>前缀的信号名，以下为部分信号的作用：</p>
<div class="table">

<table>
<thead>
<tr>
<th>代号</th>
<th>名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>0</td>
<td></td>
<td>不发送有效信号，仅用来测试进程是否存在，以及用户是否有权限向该进程发送信号</td>
</tr>
<tr>
<td>1</td>
<td>SIGHUP</td>
<td>挂起进程，常用于通知进程重新加载配置文件或重启</td>
</tr>
<tr>
<td>2</td>
<td>SIGINT</td>
<td>中断进程(可通过ctrl+C发起)，常用于进程执行到一半中途停止，<span class="text-blue">该信号可以被捕获</span></td>
</tr>
<tr>
<td>3</td>
<td>SIGQUIT</td>
<td>退出进程(可通过Ctrl+\发起)，并保存进程当前的内存映像生成core文件，用于调试</td>
</tr>
<tr>
<td>4</td>
<td>SIGILL</td>
<td>非法指令，表示进程可能在试图执行一个不符合操作系统或CPU架构规范的指令</td>
</tr>
<tr>
<td>5</td>
<td>SIGTRAP</td>
<td>跟踪/断点陷阱，通常用于在设置断点进行调试时，将进程设为跟踪模式</td>
</tr>
<tr>
<td>6</td>
<td>SIGABRT</td>
<td>异常终止，表示进程发生了致命错误导致进程终止</td>
</tr>
<tr>
<td>7</td>
<td>SIGBUS</td>
<td>总线错误，表示进程尝试执行无效的内存访问(如：尝试写入只读内存)</td>
</tr>
<tr>
<td>8</td>
<td>SIGFPE</td>
<td>浮点异常，表示进程执行了错误的浮点运算，如除以零或结果超出浮点数表示范围等</td>
</tr>
<tr>
<td>9</td>
<td>SIGKILL</td>
<td>强制终止进程，进程将被立即终止而不给予进程保存文件、写入日志等操作时间，<span class="text-red">该信号无法被捕获</span></td>
</tr>
<tr>
<td>10</td>
<td>SIGUSR1</td>
<td>用户自定义信号1</td>
</tr>
<tr>
<td>11</td>
<td>SIGSEGV</td>
<td>段错误</td>
</tr>
<tr>
<td>12</td>
<td>SIGUSR2</td>
<td>用户自定义信号2</td>
</tr>
<tr>
<td>13</td>
<td>SIGPIPE</td>
<td>写到已关闭的管道</td>
</tr>
<tr>
<td>14</td>
<td>SIGALRM</td>
<td>闹钟</td>
</tr>
<tr>
<td>15</td>
<td>SIGTERM</td>
<td>正常终止进程，kill命令的默认信号，进程将被允许进行保存文件等操作后正常退出，<span class="text-blue">该信号可以被捕获</span></td>
</tr>
<tr>
<td>16</td>
<td>SIGSTKFLT</td>
<td>栈溢出</td>
</tr>
<tr>
<td>17</td>
<td>SIGCHLD</td>
<td>子进程结束</td>
</tr>
<tr>
<td>18</td>
<td>SIGCONT</td>
<td>继续停止的进程执行，即恢复通过信号19和20所暂停的进程执行</td>
</tr>
<tr>
<td>19</td>
<td>SIGSTOP</td>
<td>强制暂停进程，由系统层面发出，<span class="text-red">该信号无法被捕获</span></td>
</tr>
<tr>
<td>20</td>
<td>SIGTSTP</td>
<td>暂停进程(可通过Ctrl+Z发起)并放到后台，可以通过<span class="tips">fg</span>命令将其恢复到前台继续执行，或通过<span class="tips">bg</span>命令在后台继续执行，<span class="text-blue">该信号可以被捕获</span></td>
</tr>
</tbody></table>
</div>

<h5 id="kill向进程发送信号"><a href="#kill向进程发送信号" class="headerlink" title="kill向进程发送信号"></a>kill向进程发送信号</h5><p><span class="strong">kill [-信号] [进程PID1,PID2…]</span> </p>
<ul>
<li>默认情况下，如果不指定信号，命令将发送SIGTERM(15)信号</li>
<li>信号可以使用<span class="tips">代号</span>形式，也可以使用<span class="tips">信号名</span>形式，也可以是去除了<span class="tips">SIG</span>前缀的信号名形式</li>
<li><span class="strong">-s 信号</span>：指定信号，该选项可以直接缩写为<span class="tips">-信号</span>形式，该选项完整形式为<span class="tips">-&zwnj;-signal 信号</span></li>
<li><span class="strong">-l [信号]</span>：默认查看所有信号，如果指定了信号则只输出该信号的信号名或信号代号</li>
<li>不同的PID值，kill命令有不同作用：<blockquote>
<blockquote>
<ul>
<li>如果PID为正值，则将信号发送给该PID对应的进程</li>
<li>PID为<span class="tips">0</span>，则信号会被发送给所有与当前shell或进程同属一个进程组的所有进程，这通常用于终止与当前进程或脚本有关的所有进程，而不仅仅是一个单一的进程</li>
<li>PID为<span class="tips">-1</span>，则信号会被发送给所有当前用户有权限发送的进程。对于普通用户，信号会被发送给该用户有权控制的所有进程，对于root用户，<span class="text-red">这可能会影响系统的所有进程！</span>，一次性关闭所有进程，应当谨慎使用</li>
<li>PID为<span class="tips">-1以外的负值</span>，信号会被发送给所有进程组ID(PGID)=|PID|(绝对值)的进程组中的所有进程</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
<div class="show">1. 发送信号时，以下几个语句等价，都表示发送SIGTERM信号给PID为1234的进程
kill -SIGTERM 1234 #完整的信号表示
kill -TERM 1234    #省略SIG前缀
kill -15 1234      #使用信号编号形式
kill -s SIGTERM 1234 #使用-s选项
kill -s 15 1234
kill 15 1234       #使用信号编号时也可以省略-
2. 测试PID为1234的进程是否存在，以及当前用户是否有权访问它
kill -0 1234
返回<span class="tips">0</span>，表示进程存在且用户有权访问
返回<span class="tips">ESRCH</span>，表示进程不存在
返回<span class="tips">EPERM</span>，表示进程存在，但用户无权访问
3. 终止当前进程组中的所有进程
kill -TERM 0
4. 终止进程组ID为456的进程组中的所有进程
kill -KILL -456
</div>


<h5 id="killall命令"><a href="#killall命令" class="headerlink" title="killall命令"></a>killall命令</h5><p><span class="strong">killall [参数][信号代号] [进程名]</span> 根据进程名中止进程</p>
<ul>
<li>-i &emsp;询问是否杀死某进程</li>
<li>-I &emsp;忽略进程名大小写</li>
</ul>
<h5 id="pkill命令"><a href="#pkill命令" class="headerlink" title="pkill命令"></a>pkill命令</h5><p><span class="strong">pkill [参数][信号代号] [进程名]</span></p>
<ul>
<li>-t 终端号 &emsp;按终端号关闭用户的连接(踢出用户)</li>
</ul>
<div class="show"># pkill -9 -t tty1
关闭终端号为 tty1 用户的连接
</div>

<h3 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h3><p>在Linux中，可以通过创建和启用交换空间(Swap)来添加虚拟内存，以缓解内存压力，避免内存不足时，进程直接被OOM Killer杀死，导致服务不可用。</p>
<h4 id="创建虚拟内存"><a href="#创建虚拟内存" class="headerlink" title="创建虚拟内存"></a>创建虚拟内存</h4><p>Linux中创建和启用虚拟内存需要依次执行以下步骤:</p>
<ul>
<li>创建虚拟内存文件</li>
<li>格式化该文件</li>
<li>启用文件作为虚拟内存使用</li>
</ul>
<p>1.检查当前的内存、磁盘、swap使用情况</p>
<div class="shell">1.检查磁盘使用，查看是否有足够磁盘剩余使用空间
df -h
<code>Filesystem      Size  Used Avail Use% Mounted on
tmpfs           178M  1.2M  177M   1% /run
/dev/vda1        40G   13G   26G  33% /
tmpfs           886M  4.1M  882M   1% /dev/shm
tmpfs           5.0M     0  5.0M   0% /run/lock
tmpfs           178M  4.0K  178M   1% /run/user/0</code>
2. 检查内存与使用情况
free -h  
<code>               total        used        free      shared  buff/cache   available
Mem:           1.7Gi       240Mi       304Mi       6.0Mi       1.2Gi       1.3Gi
Swap:             0B          0B          0B</code>
</div>

<p>2.根据内存与磁盘使用情况，创建Swap文件</p>
<p>根据当前RAM大小和使用情况决定要创建的虚拟内存大小:</p>
<ul>
<li><span class="strong">小内存(RAM≤2GB)</span>：建议虚拟内存大小为1~2倍RAM(如 1GB RAM → 1~2GB Swap)</li>
<li><span class="strong">中等内存(RAM2~8GB)</span>：建议虚拟内存大小为0.5~1倍RAM(如 4GB RAM → 2~4GB Swap)</li>
<li><span class="strong">大内存(RAM≥8GB)</span>：内存已足够大部分场景使用，实际依赖 Swap 的概率较低，建议只需要预留2~4GB左右Swap以应对突发情况，无需根据RAM大小按比例分配。</li>
</ul>
<p>创建的swap文件需要时连续的存储空间，而不是带有空洞(Holes)或者碎片化的，因此通过cp、truncate等命令创建的文件将无法作为交换空间使用，最推荐的方法是使用dd命令和/dev/zero文件</p>
<div class="show">在根目录下创建swap文件
dd if=/dev/zero of=/swapfile bs=1M count=4096
</div>

<p>3.为swap文件设置权限</p>
<p>swap文件用来存储内存中的某些临时内容，为防止其他用户或恶意程序窃取信息，权限限制为600，即只保留root用户的读写权限，方便root用户在不需要时删除swap文件。该权限必须严格设置为600，否则可能会在后续格式化虚拟内存文件时报错</p>
<div class="show">chmod 600 /swapfile</div>

<p>4.格式化为swap</p>
<p>在创建完swap文件后，需要使用<span class="tips">mkswap</span>命令将其格式化。mkswap命令会在文件/分区头部写入特殊的标识符(SWAPSPACE2)，以向内核标记这是一个合法的Swap空间，随后命令会写入Swap元数据，包括记录 Swap 区域的大小，设置 UUID(唯一标识符，用于/etc/fstab 挂载)，建立 Swap 空间的管理结构（如页表索引）等</p>
<div class="show">mkswap /swapfile</div>

<div class="shell">格式化后swapfile文件信息
Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)
no label, UUID=4dcd0b34-9304-4637-a920-32910ec736dd</div>

<p>5.启用swap交换空间作为虚拟内存</p>
<div class="show">swapon /swapfile</div>

<p>6.永久生效</p>
<p>修改<span class="tips">/etc/fstab</span>文件，使系统启动时能自动挂载该虚拟文件:</p>
<div class="shell">向/etc/fstab文件中添加
/swapfile none swap sw 0 0</div>

<p>7.调整 Swap 使用倾向（可选）</p>
<p>修改 swappiness（默认值通常为 60，范围 0-100）</p>
<div class="shell">sysctl vm.swappiness=10</div>

<p>使swap使用倾向永久生效：</p>
<div class="shell">echo "vm.swappiness=10" | sudo tee -a /etc/sysctl.conf</div>

<p>8.验证swap</p>
<p>查看所创建的虚拟内存是否已经可用</p>
<div class="shell">swapon --show
或
free -h</div>

<p>9.删除虚拟内存</p>
<div class="shell">sudo swapoff /swapfile 
sudo rm /swapfile</div>

<p>然后删除 /etc/fstab 中的对应行</p>
<h4 id="mkswap设置交换文件"><a href="#mkswap设置交换文件" class="headerlink" title="mkswap设置交换文件"></a>mkswap设置交换文件</h4><p><span class="strong">mkswap [选项] 设备/文件</span></p>
<ul>
<li>命令参数可以是一个磁盘分区，也可以是一个普通文件</li>
<li>-c 如果参数是一个磁盘分区(块设备)，在创建交换分区之前检查是否有坏块，并输出数量</li>
<li>-f 强制执行操作，即使操作看起来不安全</li>
<li>-L 标签名：为交换文件指定标签，后续swapon命令和/etc/fstab文件中可以使用该标签操作</li>
<li>-U uuid：手动指定交换区的UUID，不使用该选项，命令也会默认生成一个uuid，后续可以使用该UUID在/etc/fstab 中挂载设备。该uuid参数也可以是：</li>
<li>clear:清除该交换文件的uuid</li>
<li>random：随机生成新的uuid</li>
<li>time：生成新的基于时间的uuid</li>
<li>-q 静默模式，不输出信息，包括警告信息</li>
</ul>
<div class="shell">命令会自动生成uuid并输出其他信息
Setting up swapspace version 1, size = 2 GiB (2147479552 bytes)
no label, UUID=4dcd0b34-9304-4637-a920-32910ec736dd
</div>

<h4 id="swapon-swapoff-启用-禁用交换空间"><a href="#swapon-swapoff-启用-禁用交换空间" class="headerlink" title="swapon/swapoff 启用/禁用交换空间"></a>swapon/swapoff 启用/禁用交换空间</h4><p><span class="strong">swapon [选项] [交换分区/文件]</span>启用交换空间</p>
<p><span class="strong">swapoff [选项] [交换分区/文件]</span>禁用交换空间</p>
<ul>
<li>命令参数可以是设备文件名/普通文件名，也可是mkswap命令-L选项指定的标签名，或者-U选项指定的uuid</li>
<li>-a 启动/禁用所有交换空间，命令会读取/etc/fstab文件，查找所有带有 swap 类型的条目，并自动启用/禁用它们(带有noauto选项的除外)，通常用于系统启动时自动挂载所有交换空间</li>
<li>-T 路径：指定一个文件以替代/etc/fstab文件作为读取配置的文件</li>
<li>-e 以静默方式跳过不存在的设备</li>
<li>-d 启用交换空间的 TRIM/discard 支持（SSD 优化）</li>
<li>-p 值：指定一个值(0-32767)作为使用该交换空间的优先级，值越大优先越高</li>
<li>-&zwnj;-show 格式化输出交换空间状态</li>
<li>-s 显示当前交换空间状态，相当于cat /proc/swaps，该选项弃用，推荐使用-&zwnj;-show选项</li>
<li>-v 详细输出信息</li>
<li>-V 查看版本号</li>
</ul>
<h4 id="proc-swaps-文件"><a href="#proc-swaps-文件" class="headerlink" title="/proc/swaps 文件"></a>/proc/swaps 文件</h4><p>/proc/swaps 是 Linux 系统中的一个虚拟文件(存放于内存而非硬盘)，用于显示当前系统中交换空间（Swap）的使用情况，当创建并启用交换空间后，该文件会动态生成关于交换空间的信息。修改交换空间需通过 swapon/swapoff 命令，直接编辑此文件无效，在一些没有交换空间的系统中，该文件可能为空</p>
<div class="show">/proc/swaps文件内容示例：
<code>Filename                Type        Size      Used    Priority
/dev/sda2               partition   2097148   0       -1
/swapfile               file        102396    0       -2</code>
Filename为交换分区/交换文件的路径
Type为交换空间类型，partition表示使用磁盘分区作为交换空间，file表示使用普通文件作为交换文件
Size表示交换空间的总大小（以 KB 为单位）
Priority为交换空间的优先级，数值越高优先级越高
</div>


<h3 id="工作管理"><a href="#工作管理" class="headerlink" title="工作管理"></a>工作管理</h3><h4 id="将程序转入后台运行-暂停"><a href="#将程序转入后台运行-暂停" class="headerlink" title="将程序转入后台运行/暂停"></a>将程序转入后台运行/暂停</h4><p><span class="strong">在命令后添加 <span class="tips"> &amp; </span>，可使该命令在后台执行</span>，后台执行的任务如果有输出语句依旧会显示于屏幕上(STDOUT和STDERR的消息)</p>
<div class="show">如：
# tar -zxf test.tar.gz &
会在方括号中返回该任务在后台进程的作业号，并返回进程的PID
[1] 3231
然后将会在后台解压缩 test.tar.gz文件，执行完会提示Done并显示任务号
[1] Done
</div>

<p><span class="strong">在命令运行时执行<span class="tips"> Ctrl + Z </span> 是将当前工作暂停后转入后台</span></p>
<div class="show">如：
# top
执行Ctrl + Z会将监视系统资源的top程序设为stopped(暂停)状态后转入后台
</div>

<h4 id="jobs查看后台的工作"><a href="#jobs查看后台的工作" class="headerlink" title="jobs查看后台的工作"></a>jobs查看后台的工作</h4><p><span class="strong"> jobs [选项]</span></p>
<ul>
<li>-l &emsp;显示进程的PID和作业号</li>
<li>-p &emsp;只显示进程PID</li>
<li>-r &emsp;只显示运行中的进程</li>
<li>-s &emsp;只显示停止的进程</li>
</ul>
<div class="shell">[1]   Stopped                 top
[2]-  Stopped                 top
[3]+  Stopped                 top</div>

<p>[3]代表工作序号，“+”号代表最后一个放入后台的工作，“-”号代表倒数第二个放入后台的工作，恢复时默认使用出栈方式从最后一个放入后台的工作开始恢复</p>
<h4 id="表示任务的方法jobspec"><a href="#表示任务的方法jobspec" class="headerlink" title="表示任务的方法jobspec"></a>表示任务的方法jobspec</h4><p>在后台任务jobs中，可以使用以下方式表示一个作业，作为fg、bg、wait、kill、disown的命令参数</p>
<ul>
<li><span class="tips">%工作序号</span>：匹配对应的工作序号(作业编号)，n为jobs命令输出信息的编号，如：%1</li>
<li><span class="tips">%字符串</span>：匹配命令行开头包含指定字符串的任务，如：%python</li>
<li><span class="tips">%?字符串</span>：匹配命令行任意位置包含指定字符串的任务，如：%?data</li>
<li><span class="tips">%%或%+</span>：表示当前作业，即最后一个放入后台的任务</li>
<li><span class="tips">%-</span>：表示上一个作业，即当前作业的前一个</li>
</ul>
<h4 id="fg将后台暂停的工作恢复到前台执行"><a href="#fg将后台暂停的工作恢复到前台执行" class="headerlink" title="fg将后台暂停的工作恢复到前台执行"></a>fg将后台暂停的工作恢复到前台执行</h4><p><span class="strong"> fg [jobspec]</span></p>
<ul>
<li>%可省略，如果不指定参数，则默认从最后放入的工作开始恢复</li>
</ul>
<h4 id="bg将后台暂停的工作恢复到后台执行"><a href="#bg将后台暂停的工作恢复到后台执行" class="headerlink" title="bg将后台暂停的工作恢复到后台执行"></a>bg将后台暂停的工作恢复到后台执行</h4><p><span class="strong"> bg [jobspec]</span></p>
<ul>
<li>%可省略，如果不指定参数，则默认从最后放入的工作开始恢复</li>
</ul>
<div class="broadcast color-green">
<div class="iconfont icon-qiqiu"></div>
top，vi等服务于前台的命令，不能恢复到后台执行。</div>

<h4 id="disown将后台任务从终端jobs任务列表移除"><a href="#disown将后台任务从终端jobs任务列表移除" class="headerlink" title="disown将后台任务从终端jobs任务列表移除"></a>disown将后台任务从终端jobs任务列表移除</h4><p>默认情况下，Shell会跟踪所有后台任务，当终端关闭时，shell会向它们发送SIGHUP信号，来关闭这些任务(退出终端，shell会提示有任务正在运行)。disown会将任务从当前终端的jobs任务表中移除(此时jobs命令返回值将不再包含该任务)，使之脱离终端影响，并继续在后台运行，此时，即便终端退出也不会影响任务运行。与nohup不同的是，disown是让已经在运行的后台任务脱离终端，且不会自动处理输入输出的重定向；而nohup用来启动新任务并让其脱离终端影响，且nohup会自动进行重定向。</p>
<p><span class="strong">disown [选项] [jobspec或PID]</span></p>
<ul>
<li>-a 移除所有后台任务，使它们脱离终端</li>
<li>-h 保留任务在jobs列表中不移除，但使任务忽略SIGHUP信号</li>
<li>-r 仅移除运行中的任务</li>
</ul>
<div class="show">使作业1忽略SIGHUP信号
disown -h %1</div>

<h4 id="chroot指定新根目录并运行命令"><a href="#chroot指定新根目录并运行命令" class="headerlink" title="chroot指定新根目录并运行命令"></a>chroot指定新根目录并运行命令</h4><p>chroot命令的作用是指定一个目录将其设置为虚拟的根目录，使后续命令在该虚拟根目录下执行。该命令通常用于创建一个受限的文件系统环境，使某些进程无法访问真实的系统文件。这个“根目录变更”行为类似于为进程设置一个“虚拟根目录”，这样进程就只能看到新根目录下的文件结构，从而增强系统的隔离和安全性，该命令可用于以下场景：</p>
<ul>
<li>构建隔离环境：构建受限环境 (jail)，限制用户或进程只能够访问特定目录下的资源，防止其对主系统产生影响</li>
<li>测试与开发：受限环境中测试软件或脚本，而不影响真实系统</li>
<li>运行旧版或兼容软件：创建一个虚拟环境来运行旧版软件或与当前操作系统不兼容的软件</li>
<li>系统修复：当系统因配置错误或损坏而无法启动时，可以使用 chroot 命令进入系统的根文件系统并进行修复操作</li>
</ul>
<p><span class="strong">chroot [选项] 新的根目录 [命令]</span><span class="tips">该命令需要root权限</span></p>
<ul>
<li>如果未指定命令，则将启动一个新的shell(具体哪一个shell取决于SHELL环境变量或/bin/sh)</li>
<li>新目录中需要有shell或所执行命令的二进制文件，否则将报错command not found</li>
<li>-&zwnj;-userspec=用户名或ID[:组名或组ID]：以指定的用户身份，用户组身份执行命令</li>
<li>-&zwnj;-groups=组名或组ID：将该组作为命令进程的附加组</li>
</ul>
<div class="show">  由于chroot命令会将执行环境限制到新的根目录中，因此所有需要使用的资源(包括命令的二进制文件、依赖等)都需要复制一份到新根目录中。如果不为chroot命令指定所要执行的命令，chroot会在该受限环境中启动一个新的shell，同样需要将shell的二进制文件、依赖提前复制到该新目录中，否则，所有命令都将因为找不到命令的二进制文件而提示command not found
e.g.1要将/mnt/my_chroot设置为新的虚拟根目录，且在该目录下执行ls命令
1.查看ls命令的依赖
ldd /bin/ls
输出：
linux-vdso.so.1 (0x00007ffc0865f000)
libselinux.so.1 => /lib/x86_64-linux-gnu/libselinux.so.1 (0x000075e890fcf000)
libc.so.6 => /lib/x86_64-linux-gnu/libc.so.6 (0x000075e890c00000)
libpcre2-8.so.0 => /lib/x86_64-linux-gnu/libpcre2-8.so.0 (0x000075e890f35000)
/lib64/ld-linux-x86-64.so.2 (0x000075e89102a000)
2.将这些依赖和/bin/ls复制到/mnt/my_chroot中，并且文件结构要相同
3.随后才能执行chroot命令
sudo chroot /mnt/my_chroot ls
e.g.2.如果不为chroot指定具体要执行的命令，chroot命令将在/mnt/my_chroot中启动一个子bash，同样需要使用上述步骤将bash的程序和依赖复制到/mnt/my_chroot目录下，才能启动bash，对于该bash以及在bash中执行的命令来讲，/mnt/my_chroot将是它们的根目录/，它们将无法访问/mnt/my_chroot及其子目录以外的资源
</div>

<h4 id="env在修改后的环境中运行命令"><a href="#env在修改后的环境中运行命令" class="headerlink" title="env在修改后的环境中运行命令"></a>env在修改后的环境中运行命令</h4><p><span class="strong">env [选项] [环境变量=值] [命令]</span></p>
<ul>
<li>默认输出当前用户的所有环境变量，如果指定了环境变量赋值语句和命令，则该命令会在新的环境变量中执行</li>
<li>-i 清除所有继承的环境变量，在一个干净环境中执行命令</li>
<li>-u 变量名：删除指定的变量，再执行命令</li>
<li>-C 文件名：在指定目录下运行命令，而不改变当前的工作目录</li>
</ul>
<div class="show">1.在添加了新环境变量后，在新环境中执行命令
env MY_VAR=hello bash -c 'echo $MY_VAR'
2. 在删除了某个变量的环境中执行命令
env -u MY_VAR bash -c 'echo $MY_VAR'
3.在在/tmp目录下执行ls命令，但不改变当前Shell的工作目录
env -C /tmp ls
4.从file.env文件中批量加载环境变量并通过env命令输出验证
source file.env && env
5.在脚本首行指定解释器路径
#!/usr/bin/env python3
如果直接使用 #!/usr/bin/python3，在某些系统中，python3可能并不位于/usr/bin目录下，可能导致系统无法找到解释器，而使用#!/usr/bin/env python3，系统会尝试前往环境变量的PATH中查看python3的位置，提高脚本的通用性
</div>

<h4 id="nohub退出终端时继续执行命令"><a href="#nohub退出终端时继续执行命令" class="headerlink" title="nohub退出终端时继续执行命令"></a>nohub退出终端时继续执行命令</h4><p>当命令或脚本正在运行时，如果此时退出了当前用户或shell终端，那么这些从该终端启动的进程也会随之退出(shell终端会向它们发送SIGHUP信号)。如果希望这些进程在退出用户或shell后仍能继续运行，则需要用一个特殊的命令<span class="tips">nohup</span>来阻断所有发送给该进程的SIGHUP信号，这样命令或脚本在shell退出时会继续运行，其语法为：</p>
<div class="api-block">nohub 命令或脚本</div>

<div class="show">e.g.该命令也可以和&一起用，使脚本在后台执行并在终端退出时继续执行
nohub ./test.sh &
</div>

<p>我们使用的脚本和命令都与调用该命令的终端会话(如pts/0)相关联(可以通过ps命令查看进程所属的终端)。当退出终端时，如果存在被停止的进程或仍在运行的后台进程，大多数终端会发出警告提示有未完成的任务。在使用nohub命令后，该命令会解除终端与进程的关联，进程将不再继承终端的标准输出（STDOUT）和标准错误（STDERR）。nohup会将stdin重定向到/dev/null，并在当前路径下创建一个名为<span class="tips">nohup.out</span>的文件，并将STDOUT和STDERR的消息重定向到该文件中，因此所执行命令将无法接收任何输入，且不输入任何内容到终端。如果当前路径下无法创建或写入<span class="tips">nohup.out</span>文件，则会尝试创建<span class="tips">$HOME/nohup.out</span>，如果这两个文件都无法创建，命令将不执行。也可以将其输出重定向到<span class="tips">nohup.out</span>以外的文件</p>
<div class="show">nohup ls &gt; make.log
返回提示信息
nohup: ignoring input and appending output to 'nohup.out'
2.虽然nohup调用的命令无法再从终端接收参数，但依旧可以使用&lt;手动从文件输入数据
nohup cat < input.txt &
默认情况下，stdin是当前终端，在调用nohup后stdin将被重定向到/dev/null
但如果显式重定向了stdin，则nohup将不会再重定向stdin到/dev/null了
</div>

<h4 id="setsid在新会话中执行命令"><a href="#setsid在新会话中执行命令" class="headerlink" title="setsid在新会话中执行命令"></a>setsid在新会话中执行命令</h4><p>setsid会创建新的会话和新的进程组，并与原终端分离(没有控制终端)，但stdout和stderr依旧会默认继承父进程的输出，stdin将被关闭或重定向到/dev/null(取决于具体shell实现)。</p>
<p><span class="strong">setsid [选项] 命令或脚本</span></p>
<ul>
<li>-c tty号：手动指定一个控制终端</li>
<li>-w 等待命令退出</li>
</ul>
<div class="show">
脚本server.sh模拟一个长期运行的服务
#!/bin/bash
echo "脚本已启动"
sleep infinity
脚本run.sh
#!/bin/bash
start_server(){
<span class="text-blue">setsid sudo -u steam ./server.sh > /dev/null 2>&1  < /dev/null &</span>
}
stop_server() {
....
}
main(){
while true;do
echo "菜单栏"
echo "1 启动服务"
echo "2 关闭服务"
read -p "选择功能" choice
case "$choice" in
        1) start_server ;;
        2) stop_server ;;
esac
done
}
main
在上述脚本中，如果直接执行
sudo -u steam ./server.sh
sudo会创建steam用户新进程组，并继承父进程(脚本)的控制终端，导致终端被后台进程持有
此时输入任何内容(包括ctrl+C)都无法将信号传入到脚本中，从而出现终端"卡死"，只能断开连接后重连来恢复控制权
使用setsid可以新建一个新的会话，避免sudo创建的进程持有当前会话和终端
</div>

<h4 id="timeout限制命令执行时间"><a href="#timeout限制命令执行时间" class="headerlink" title="timeout限制命令执行时间"></a>timeout限制命令执行时间</h4><p>如果命令在到达指定时间后仍在运行，则将其终止，防止命令或脚本长时间挂起或无限循环的进程持续占用系统资源</p>
<p><span class="strong">timeout [选项] 时间 命令</span></p>
<ul>
<li>时间后缀可以为<span class="tips">s(秒)、m(分钟)、h(小时)、d(天)</span></li>
<li>-s 信号名或信号编号：超时后发送指定的信号，默认为SIGTERM</li>
<li>-&zwnj;-preserve-status 超时后返回被终止命令的退出状态码，而不是timeout命令的退出状态码</li>
<li>-&zwnj;-foreground 让目标命令在前台运行，即使timeout在后台调用</li>
<li>-k 时间time：默认情况下，timeout命令会在到达指定时间后向命令发出SIGTERM信号或-s选项指定的信号，但这些信号可能会被捕获，或者由于需要保存数据进程会保留一段时间。-k选项可以给与一个额外的时间time，如果进程在收到第一个信号后的time时间，仍然没有关闭，则timeout命令会发送SSIGKILL信号(不可捕获)来强制关闭进程，time也可以使用s、m、h、d为后缀</li>
</ul>
<div class="show">1.指定命令的最长执行时间
timeout 10s ping google.com
2. 让vim在前台运行，并且只能运行30s
timeout --foreground 30s vim
3. 限制tail -f命令运行10秒，在10s后发送SIGTERM信号
如果tail命令在收到SIGTERM信号后2秒内仍未退出，则 timeout 会发送SIGKILL信号，强制杀掉该进程
timeout -k 2s 10s tail -f /var/log/syslog
</div>

<h4 id="调整谦让度"><a href="#调整谦让度" class="headerlink" title="调整谦让度"></a>调整谦让度</h4><p>Linux是多任务操作系统，进程在调用系统资源和占用CPU时间有不同的优先级，称之为调度优先级(scheduling priority)，调度优先级由系统内核负责分配，nice命令可以通过调整niceness的值，影响调度程序计算程序的调度优先级。但注意，niceness只是给调度器的建议，调度器可以自由选择是否忽略它，即nice命令只能一定程度影响调度器的优先级计算方式，不直接作用调度优先级。</p>
<p>默认情况下，普通进程的niceness值为0，为正常优先级，niceness的取值范围为-20(最高优先级)到+19(最低优先级)，<span class="tips">注意！值越小优先级越高</span>，</p>
<h5 id="nice指定调度优先级"><a href="#nice指定调度优先级" class="headerlink" title="nice指定调度优先级"></a>nice指定调度优先级</h5><p>通过<span class="tips">nice</span>命令可以查看当前进程的优先级，如果要指定命令或脚本的调度优先级，可以使用下述语法：</p>
<p><span class="strong">nice [选项] [命令]</span></p>
<ul>
<li>默认给与的niceness值为10</li>
<li>-n 值：给与指定的值，而不是默认的10</li>
<li><span class="tips">只有root用户才能将进程的优先级值设置为负值，即只有root用户能提高进程的优先级，但允许所有用户降低进程的优先级</span></li>
</ul>
<div class="show">nice命令中，-n选项可以直接替换为-值的形式
nice -n 10 ./test4.sh
nice -10 ./test4.sh
调整优先级后，可以通过ps命令在NI一列查询到进程优先级
#ps -o pid,ppid ni,cmd
PID  PPID NI CMD 
4993 4721 10 /bin/bash ./test4.sh
</div>


<h5 id="renice修改调度优先级"><a href="#renice修改调度优先级" class="headerlink" title="renice修改调度优先级"></a>renice修改调度优先级</h5><p>如果要调整已运行命令的优先级，可以使用renice命令(需要通过进程PID修改)：</p>
<p><span class="strong">renice -n 值 -p 进程PID</span></p>
<ul>
<li>只能对属于该用户的进程执行renice</li>
<li>普通用户只能通过renice降低进程的优先级</li>
<li>root用户可以通过renice来任意调整进程的优先级</li>
</ul>
<h4 id="stdbuf调整命令的I-O缓冲"><a href="#stdbuf调整命令的I-O缓冲" class="headerlink" title="stdbuf调整命令的I/O缓冲"></a>stdbuf调整命令的I/O缓冲</h4><p>stdbuf命令用于临时更改命令的标准输入(stdin)、标准输出(stdout)和标准错误(stderr)的缓冲模式，缓冲模式有三种：</p>
<ul>
<li>行缓冲(line buffered)：每一行数据写入或读取时刷新缓冲区（遇到换行符时刷新），适合用于交互式命令行工具</li>
<li>完全缓冲(fully buffered)：缓冲区填满后再输出或输入，通常用于非交互式操作，提高性能</li>
<li>无缓冲(unbuffered)：数据立即写入或读取，不经过缓冲</li>
</ul>
<p>stdbuf适用于那些使用C标准库(glibc) I/O函数(如fread()和 fwrite())来处理标准输入、标准输出或标准错误的程序，如：cat、grep、sed、awk、cut、sort、head、tail、echo、printf、ls、read(作为 shell内置命令时，可能不生效，但作为外部命令时有效)、tee、tr、find、xargs、cut、wc，stdbuf无法处理那些直接使用系统调用(read()和write())作为I/O处理的函数，如：dd命令</p>
<p><span class="strong">stdbuf 选项 命令</span></p>
<ul>
<li>-i 模式：调整标准输入流的缓冲</li>
<li>-o 模式：调整标准输出流的缓冲</li>
<li>-e 模式：调整标准错误流的缓冲</li>
<li>模式可以取以下值：<blockquote>
<blockquote>
<ul>
<li>0:无任何缓冲，此模式下数据会被立刻输出</li>
<li>L：使用行缓冲模式，此模式下，输出数据会被合并，直到输出换行符，该选项对标准输入无效</li>
<li>值size：使用完全缓冲模式并指定缓冲区大小，size的值可以使用K、KB等单位</li>
</ul>
</blockquote>
</blockquote>
</li>
</ul>
<div class="show">e.g.假设 echo 命令通常是按行缓冲的，当重定向到文件或管道中时，它可能会变成全缓冲。为了使 echo 在管道中也能立即输出，可以使用
stdbuf -o0 echo "Hello, World!" | cat
-o0 表示标准输出为无缓冲
</div>

<h3 id="服务管理"><a href="#服务管理" class="headerlink" title="服务管理"></a>服务管理</h3><!-- 通过源码包安装的程序，所有文件会统一放置于如 /usr/local/ 目录下，而通过RPM包安装的程序，不同文件会放在不同目录下，如：可执行命令文件放在 /usr/bin 目录下，配置文件放在 /etc目录下。通过RPM包安装的软件服务，可以通过脚本文件启动，也可以通过service或systemctl命令直接启动，当执行该命令时，Linux会默认前往/usr/bin 目录下寻找相关文件。而通过源码包安装的服务由于安装路径不同，就无法通过该命令直接启动，但也可以将启动命令文件生成链接放置在/usr/bin目录下，这样源码包安装的服务也可以通过该命令启动了。

卸载软件时，通过源码包安装的程序直接删除对应文件即可，而通过RPM包安装的软件，由于文件散列分布，因此需要rpm -e 命令来卸载。 -->

<h4 id="服务查询"><a href="#服务查询" class="headerlink" title="服务查询"></a>服务查询</h4><p>查询服务开机自启动状态</p>
<h5 id="1-RPM包安装的应用服务"><a href="#1-RPM包安装的应用服务" class="headerlink" title="1. RPM包安装的应用服务"></a>1. RPM包安装的应用服务</h5><p><span class="strong">chkconfig -&zwnj;-list</span></p>
<p>查询所有RPM包安装的应用服务启动状态，会标出int0-6哪个级别系统启动状态下，服务会自启动。通过管道符可以查询指定服务的启动状态，如: chkconfig | grep nginx查看nginx服务的启动状态，在Centos7以后，该命令只能查看应用服务自启动情况，不包括系统本地服务，查看本地服务可以使用<span class="strong">systemctl list-unit-files</span>命令，使用管道符可以只查看指定服务的启动状况。</p>
<h5 id="2-源码包安装的服务"><a href="#2-源码包安装的服务" class="headerlink" title="2. 源码包安装的服务"></a>2. 源码包安装的服务</h5><p>查看安装位置下对应服务的配置文件，一般位于<span class="tips"> /usr/local/</span>路径下。</p>
<h4 id="RPM服务管理"><a href="#RPM服务管理" class="headerlink" title="RPM服务管理"></a>RPM服务管理</h4><h5 id="独立服务管理"><a href="#独立服务管理" class="headerlink" title="独立服务管理"></a>独立服务管理</h5><p>常用文件路径</p>
<div class="table">

<table>
<thead>
<tr>
<th align="center">路径</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">/etc/init.d</td>
<td align="center">启动脚本位置</td>
</tr>
<tr>
<td align="center">/etc/xinetd.d</td>
<td align="center">基于xinetd 服务的启动脚本</td>
</tr>
<tr>
<td align="center">/etc/sysconfig</td>
<td align="center">初始化环境配置文件</td>
</tr>
<tr>
<td align="center">/etc</td>
<td align="center">配置文件位置</td>
</tr>
<tr>
<td align="center">/etc/xinetd.conf</td>
<td align="center">xinetd 配置文件</td>
</tr>
<tr>
<td align="center">/var/lib</td>
<td align="center">放置服务产生的数据</td>
</tr>
<tr>
<td align="center">/var/log</td>
<td align="center">日志</td>
</tr>
</tbody></table>
</div>

<h5 id="独立服务命令"><a href="#独立服务命令" class="headerlink" title="独立服务命令"></a>独立服务命令</h5><ul>
<li><p><span class="strong">/etc/init.d/服务名&emsp;start/stop/status/restart </span></p>
</li>
<li><p><span class="strong">service/systemctl&emsp;服务名&emsp;start/stop/status/restart </span>&emsp;红帽系列系统专属</p>
</li>
</ul>
<h5 id="独立服务自启动"><a href="#独立服务自启动" class="headerlink" title="独立服务自启动"></a>独立服务自启动</h5><ul>
<li>将启动程序的命令写入<span class="tips"> /etc/rc.d/rc.local</span>文件中，系统启动后会自动执行该文件中的所有命令</li>
<li>chkconfig 服务名 on/off &emsp;开启、关闭自启动，默认在2345运行级别下自启动</li>
</ul>
<h5 id="基于xinetd-超级守护进程-服务"><a href="#基于xinetd-超级守护进程-服务" class="headerlink" title="基于xinetd(超级守护进程)服务"></a>基于xinetd(超级守护进程)服务</h5><p>xinetd负责管理系统中不频繁使用的服务，这些服务程序在有请求时才由xinetd服务负责启动运行，一旦完成服务请求服务程序结束运行，以减少对系统资源的占用。</p>
<p>基于 xinetd 的服务没有自己独立的启动脚本程序，需要依赖 xinetd 的启动脚本来启动。xinetd 本身是独立的服务，启动xinetd 服务的方法和启动独立服务的方法一致。</p>
<p>基于 xinetd 的服务只需修改 <span class="tips"> /etc/xinetd.d/服务名 </span> 文件下的 <span class="tips"> /disable</span>为 <span class="tips"> no</span>，然后重启xinetd 服务即可</p>
<div class="broadcast color-pink">
<div class="iconfont icon-yinle1"></div>
xinetd常用于红帽系列的操作系统，需要用户自行安装</div>

<h4 id="源码包安装的服务管理"><a href="#源码包安装的服务管理" class="headerlink" title="源码包安装的服务管理"></a>源码包安装的服务管理</h4><h5 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h5><p>源码包安装的服务一般通过绝对路径下的脚本启动，具体路径需查看安装说明INSTALL文件。</p>
<h5 id="自启动"><a href="#自启动" class="headerlink" title="自启动"></a>自启动</h5><p>将启动程序的命令写入<span class="tips"> /etc/rc.d/rc.local</span>文件中，系统启动后会自动执行该文件中的所有命令</p>
<h4 id="查看开机时服务启动顺序"><a href="#查看开机时服务启动顺序" class="headerlink" title="查看开机时服务启动顺序"></a>查看开机时服务启动顺序</h4><p>Linux开机或关机时的服务启动/关闭顺序写于文件<span class="tips"> /etc/rc.d/</span>路径下的对应文件中， <span class="tips"> rc0-rc6 </span>文件中分别书写有系统不同启动级别下服务启动顺序。如 rc3 中，S85nginx表示系统启动时，nginx将是第85个启动的服务，K15nginx表示系统关机时，nginx将是第15个关闭的服务。</p>
<h3 id="alternatives工具"><a href="#alternatives工具" class="headerlink" title="alternatives工具"></a>alternatives工具</h3><h4 id="alternatives简介"><a href="#alternatives简介" class="headerlink" title="alternatives简介"></a>alternatives简介</h4><p>alternatives工具常用于指定默认软件、默认配置，或者某一软件的默认版本。</p>
<p>如：在Linux中，yum等工具一般使用python2作为命令解释器，而一些较新的软件依赖较新版的python3。因此有时我们不得不同时安装python2和python3。如果使用 python3 作为默认的python版本，使用yum会抛出错误，这是因为使用了python3解析yum中python2的语法，同理，一些较新的软件也无法使用python2解析。此时，我们就需要使用alternatives来控制软件的默认版本。</p>
<p>alternatives的使用方法是：给定两个软件或多个软件的路径，然后将它们注册为一个组，为这个组建立一个软链接，之后调用软件将直接从这一软链接调用</p>
<h4 id="alternatives命令"><a href="#alternatives命令" class="headerlink" title="alternatives命令"></a>alternatives命令</h4><h5 id="注册组"><a href="#注册组" class="headerlink" title="注册组"></a>注册组</h5><p><span class="strong">alternatives -&zwnj;-install &lt;link&gt; &lt;name&gt; &lt;path&gt; &lt;priority&gt;</span></p>
<ul>
<li>-&zwnj;-install 注册(新增)需要管理的命令/软件</li>
<li>link：注册路径，会在该路径下生成一个软链，此后由该软链启动命令</li>
<li>name：组名</li>
<li>path：软件/命令的路径，将该路径下的命令加入alternatives管理组</li>
<li>priority：权值，在自动模式下，权值越高，软件优先级越高</li>
</ul>
<h5 id="其他命令"><a href="#其他命令" class="headerlink" title="其他命令"></a>其他命令</h5><ul>
<li><span class="strong">alternatives -&zwnj;-config &lt;name&gt;</span> 修改默认配置(将进入交互模式，并切换为手动模式)</li>
<li><span class="strong">alternatives -&zwnj;-set &lt;name&gt; &lt;path&gt;</span> 修改默认配置(将切换为手动模式)</li>
<li><span class="strong">alternatives -&zwnj;-auto &lt;name&gt;</span> 切换为自动模式</li>
<li><span class="strong">alternatives -&zwnj;-display &lt;name&gt;</span> 显示对应组的配置信息(包括自动/手动模式，路径，权值)</li>
<li><span class="strong">alternatives -&zwnj;-remove &lt;name&gt; &lt;path&gt;</span> 删除组中对应路径的软件</li>
<li><span class="strong">alternatives -&zwnj;-list</span> 列出所有组的信息(组名、自动/手动模式、当前默认软件路径)</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="1-注册组"><a href="#1-注册组" class="headerlink" title="1. 注册组"></a>1. 注册组</h5><p>在<span class="tips">/usr/bin</span>目录下有python2.7与python3.7的启动命令，我们可以新建python组，将python2和python3的启动路径加入到该组中，并指定python3为默认版本，此后直接执行<span class="tips">python</span>命令将唤醒python3，而不用再指定明确的版本号，且将默认唤醒python3，该默认值是可以随时更改的</p>
<div class="shell"><code># alternatives --install /usr/bin/python python /usr/bin/python2.7 10
# alternatives --install /usr/bin/python python /usr/bin/python3.6 20
</code></div>

<p>上述命令</p>
<ul>
<li>将在 <span class="tips">/usr/bin</span> 目录下新建名为 <span class="tips">python</span> 的软链接，该软链接指向<span class="tips">/etc/alternatives/python</span>，该链接又指向<span class="tips">/usr/bin/python3.6</span></li>
</ul>
<div class="show">即 /usr/bin/python --> /etc/alternatives/python --> /usr/bin/python3.6</div>

<ul>
<li>修改默认值，修改的是/etc/alternatives/python的指向，即默认值为python2.7时，/etc/alternatives/python链接指向将修改为/usr/bin/python2.7</li>
<li>python3.6的权值为20，python2.7的权值为10，自动模式下，alternatives将优先调用python3.6</li>
<li>生成链接名可以任意自定义，并且调用命令也将相应修改，如：<div class="shell"><code>alternatives --install /usr/bin/py ppyy /usr/bin/python3 10</code></div>
调用命令将变为py:
<div class="shell">py --version #同python3 --version命令</div></li>
</ul>
<h6 id="2-修改默认值"><a href="#2-修改默认值" class="headerlink" title="2. 修改默认值"></a>2. 修改默认值</h6><div class="shell"><code>alternatives --config python</code></div>
将进入交互模式，让你输入序号选择版本
<div class="shell">There are 2 programs which provide 'python'.
  Selection    Command
-----------------------------------------------
   1           /usr/bin/python2.7
*+ 2           /usr/bin/python3.6

<p>Enter to keep the current selection[+], or type selection number: </p>
</div>

<p>+号为当前生效的版本，*为新增版本</p>
<h6 id="3-查看python组信息"><a href="#3-查看python组信息" class="headerlink" title="3. 查看python组信息"></a>3. 查看python组信息</h6><div class="shell"><code>alternatives --display python</code></div>
<div class="shell">python - status is manual. #python处于手动模式
 link currently points to /usr/bin/python3.6 #当前默认使用python3.6版本
/usr/bin/python2.7 - priority 10  #可选版本信息
/usr/bin/python3.6 - priority 20
Current `best' version is /usr/bin/python3.6.
</div>

<h6 id="4-从组中删除python3-6版本"><a href="#4-从组中删除python3-6版本" class="headerlink" title="4. 从组中删除python3.6版本"></a>4. 从组中删除python3.6版本</h6><div class="shell"><code>alternatives --remove python /usr/bin/python3.6</code></div>
从python组中移除3.6版本，将只剩2.7版本可选


<h3 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h3><h4 id="at命令"><a href="#at命令" class="headerlink" title="at命令"></a>at命令</h4><p>at命令用于预设脚本或命令的运行时间，at命令的守护进程atd会以后台模式运行，检查作业队列来运行作业。大多数Linux发行版会在启动时运行此守护进程，atd守护进程会检查系统上的一个特殊目录（通常位于/var/spool/at）来获取用at命令提交的作业。默认情况下，atd守护进程会每60秒检查一下这个目录，并获取作业预定的运行时间。at命令的语法为：</p>
<p><span class="strong">at [选项] 时间</span></p>
<ul>
<li>默认情况下，输入at+时间后，at命令会进入交互模式开始接收需要执行的命令，输入完毕后通过Ctrl+D完成输入</li>
<li>如果已经错过指定时间，则命令会在第二天的同一时间再执行</li>
<li>-f 文件名：到指定时间执行该脚本</li>
<li>-q 字母：指定队列字母</li>
<li>-M 屏蔽脚本或命令的输出信息</li>
</ul>
<p>at命令支持的时间格式很多，包括：</p>
<ul>
<li>具体的精确时间，如：at 10:30、at 2pm、at 2024-06-21 15:00</li>
<li>相对时间，如：at now + 1 hour、at now + 2 days、at 3pm tomorrow、at 10:30am + 1 week</li>
<li>特定命名时间，如：at now(立即执行)、at noon(中午12:00)、at midnight(午夜12:00)、at teatime(下午茶时间4:00)、</li>
<li>AM/PM指示符，如：at 10:15PM</li>
<li>标准日期格式(MMDDYY、MM/DD/YY或DD.MM.YY)</li>
<li>文本日期，比如Jul 4或Dec 25，加不加年份均可</li>
</ul>
<div class="show">e.g.在一分钟后执行ls命令
at now + 1 minute
at&gt; ls      #进入交互模式接收命令
(Ctrl+D结束输入)
或
echo "ls" | at now + 1 minute
e.g. 执行脚本
at -f ./test.sh 
</div>

<p>在使用at命令时，该作业会被提交到作业队列（job queue）。作业队列会保存通过at命令提交的待处理的作业。针对不同优先级，存在26种不同的作业队列。作业队列通常用小写字母a-z和大写字母A-Z来指代，作业队列的字母排序越高，作业运行的优先级就越低（更高的nice值）。默认情况下，at的作业会被提交到a作业队列。如果想以更高优先级运行作业，可以用-q参数指定不同的队列字母。</p>
<p>当作业在Linux系统上运行时，作业中的输出将不显示到屏幕上。取而代之的是，Linux系统会将提交该作业的用户的电子邮件地址作为STDOUT和STDERR。任何发到STDOUT或STDERR的输出都会通过邮件系统发送给该用户，这需要Linux安装了sendmail应用程序。如果未安装该程序，或者不需要脚本输出信息，应当做好重定向工作，或使用<span class="tips">-M</span>选项屏蔽作业产生的输出信息。</p>
<h5 id="查询at定时任务"><a href="#查询at定时任务" class="headerlink" title="查询at定时任务"></a>查询at定时任务</h5><p><span class="strong">atq</span> 查询at命令设置的作业</p>
<p>该命令会返回了作业号、系统运行该作业的日期和时间及其所在的作业队列(字母)</p>
<div class="show">e.g.返回信息类似于
20 2015-07-14 13:03 = Christine 
18 2015-07-15 13:03 a Christine 
17 2015-07-14 16:00 a Christine 
19 2015-07-14 13:30 a Christine
</div>

<h5 id="删除at定时任务"><a href="#删除at定时任务" class="headerlink" title="删除at定时任务"></a>删除at定时任务</h5><p><span class="strong">atrm 作业号</span> 删除指定的作业</p>
<p>普通用户只能删除自己提交的作业，无法删除其他用户的作业</p>
<h4 id="crond服务"><a href="#crond服务" class="headerlink" title="crond服务"></a>crond服务</h4><p>cron即计划任务，而crond则是一个常驻服务，在Linux中用于周期性执行某个任务，该服务的配置文件位于<span class="tips">/etc/crontab</span></p>
<h5 id="查看crond服务运行情况"><a href="#查看crond服务运行情况" class="headerlink" title="查看crond服务运行情况"></a>查看crond服务运行情况</h5><p><span class="strong">ps aux | grep crond</span>查看crond进程是否在运行，红帽系列的操作系统可使用<span class="strong">service status crond</span>或<span class="strong">systemctl status crond</span>(centos7+)</p>
<h5 id="查看crond服务是否开机自启动"><a href="#查看crond服务是否开机自启动" class="headerlink" title="查看crond服务是否开机自启动"></a>查看crond服务是否开机自启动</h5><p><span class="strong">chkconfig -&zwnj;-list | grep crond</span>或<span class="strong">systemctl list-unit-files | grep crond</span>(centos7+)</p>
<h4 id="设置crond定时任务"><a href="#设置crond定时任务" class="headerlink" title="设置crond定时任务"></a>设置crond定时任务</h4><p>可通过修改<span class="tips">/etc/crontab</span>文件来设置定时任务，同路径下还有 cron.daily，cron.weekly等对应时间记录crond任务的文件。也可以通过命令来修改crontab文件，语法为:</p>
<p><span class="strong">crontab [参数]</span></p>
<ul>
<li>-e &emsp;编辑crontab定时任务</li>
<li>-l &emsp;查询crontab定时任务</li>
<li>-r &emsp;删除当前用户所有crontab任务</li>
</ul>
<h5 id="cron语法"><a href="#cron语法" class="headerlink" title="cron语法"></a>cron语法</h5><p>编辑定时任务时会打开vi编辑器，编辑语法格式需遵循cron语法，基本格式为：<span class="tips"><strong>***** 命令</strong></span></p>
<ul>
<li><span class="strong">第一个*表示一小时当中的第几分钟，范围为0-59</span></li>
<li><span class="strong">第二个*表示一天当中的第几个小时，范围为0-23</span></li>
<li><span class="strong">第三个*表示一个月当中的第几天，范围为1-31</span></li>
<li><span class="strong">第四个*表示一年当中的第几个月，范围为1-12</span></li>
<li><span class="strong">第五个*表示一周当中的星期几，范围为0-7(0和7都代表星期日)</span></li>
</ul>
<div class="table">

<table>
<thead>
<tr>
<th align="left">特殊符号</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody><tr>
<td align="left">*</td>
<td align="left">代表任何时间</td>
</tr>
<tr>
<td align="left">,</td>
<td align="left">代表不连续的时间</td>
</tr>
<tr>
<td align="left">-</td>
<td align="left">代表连续的时间范围</td>
</tr>
<tr>
<td align="left">*/n</td>
<td align="left">代表隔多久执行一次</td>
</tr>
</tbody></table>
</div>

<div class="show">示例：
30 23 * * * 命令      //每天的23：30执行对应命令
0 1 1,15 * * 命令    //每个月1号和15号凌晨1:00执行命令
30 2 * * 1-3 命令   // 每周一到周三凌晨2点30执行命令
*/10 4 * * * 命令   //每天凌晨4点，每隔10分钟执行一次命令，执行6次(即小时数超过4时就停止)
0 0 1,15 * 1 命令   //每个月1号，15号和每周一凌晨00:00执行一次命令
0 2 1 * * /sbin/shutdown -r now 每个月1号凌晨2：00重启Linux
</div>

<h3 id="日志服务"><a href="#日志服务" class="headerlink" title="日志服务"></a>日志服务</h3><h4 id="rsyslog服务"><a href="#rsyslog服务" class="headerlink" title="rsyslog服务"></a>rsyslog服务</h4><p>Syslog(系统日志协议)是在一个IP网络中转发系统日志信息的标准，syslogd服务被广泛用于老版Unix/Linux系统中负责记录系统日志，RSyslog是syslog的多线程增强版，CentOS6以后系统默认使用Rsyslogd服务记录系统日志。</p>
<h5 id="查询rsyslog服务是否在运行"><a href="#查询rsyslog服务是否在运行" class="headerlink" title="查询rsyslog服务是否在运行"></a>查询rsyslog服务是否在运行</h5><p>可使用命令<span class="strong">ps aux | grep rsyslogd</span>查看rsyslog进程是否在运行，红帽系列可使用命令<span class="strong">systemctl status rsyslog</span>查看</p>
<h5 id="查看rsyslog服务是否开机自启动"><a href="#查看rsyslog服务是否开机自启动" class="headerlink" title="查看rsyslog服务是否开机自启动"></a>查看rsyslog服务是否开机自启动</h5><ul>
<li><span class="strong">chkconfig –list |grep rsyslog</span></li>
<li><span class="strong">systemctl list-unit-files | grep rsyslog</span>(centos7)</li>
</ul>
<h4 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h4><p>系统日志默认保存在 <span class="tips">/var/log</span> 路径下，对应文件的作用:</p>
<div class="table">

<table>
<thead>
<tr>
<th>文件</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>/var/log/cron</td>
<td>定时任务相关日志</td>
</tr>
<tr>
<td>/var/log/cups</td>
<td>打印系统的日志</td>
</tr>
<tr>
<td>/var/log/dmesg</td>
<td>开机内核自检的信息，使用dmesg命令就是读取了该文件</td>
</tr>
<tr>
<td>/var/log/btmp</td>
<td>错误登录日志，二进制文件，需通过<span class="tips">lastb</span>命令查看</td>
</tr>
<tr>
<td>/var/log/lastlog</td>
<td>记录所有用户最后一次登录系统的日志，二进制文件，需通过<span class="tips">lastlog</span>命令查看</td>
</tr>
<tr>
<td>/var/log/mailog</td>
<td>邮件日志</td>
</tr>
<tr>
<td>/var/log/message</td>
<td>记录系统所有重要事件信息</td>
</tr>
<tr>
<td>/var/log/secure</td>
<td>记录所有涉及用户账户和密码的信息，如：用户登录，添加用户，切换用户，sudo授权，修改密码等</td>
</tr>
<tr>
<td>/var/log/wtmp</td>
<td>永久记录所有用户的登录、注销、系统启动、重启等信息，二进制文件，需使用<span class="tips">last</span>命令查看</td>
</tr>
<tr>
<td>/var/log/utmp</td>
<td>记录当前登录的用户信息，并且随着用户注销、切换不断变化，使用w,who,users等命令查看</td>
</tr>
</tbody></table>
</div>

<p>使用RPM包安装的服务也会默认把日志文件放在<span class="tips">/vat/log/服务名</span> 路径下，但其日志由自身服务管理，而不归rsyslogd服务管理</p>
<p>使用源码包安装服务的日志文件位于用户指定的安装路径下，一般位于 /usr/local路径下</p>
<h4 id="rsyslog日志格式"><a href="#rsyslog日志格式" class="headerlink" title="rsyslog日志格式"></a>rsyslog日志格式</h4><p>日志文件通常由以下内容按顺序书写：</p>
<ul>
<li>事件产生时间</li>
<li>服务器主机名</li>
<li>产生事件的服务名</li>
<li>事件的具体信息</li>
</ul>
<h4 id="rsyslog日志配置文件"><a href="#rsyslog日志配置文件" class="headerlink" title="rsyslog日志配置文件"></a>rsyslog日志配置文件</h4><p>该配置文件位于<span class="tips">/etc/rsyslog.conf</span>，配置文件决定了日志系统记录哪些级别的日志信息，文件的格式为 <span class="tips"><strong>服务名[连接符]日志等级&emsp;&emsp;日志记录位置</strong></span></p>
<h5 id="服务名"><a href="#服务名" class="headerlink" title="服务名"></a>服务名</h5><div class="table">

<table>
<thead>
<tr>
<th>服务名称</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>auth</td>
<td>安全和认证相关信息</td>
</tr>
<tr>
<td>authpriv</td>
<td>安全和认证相关信息(私有信息)</td>
</tr>
<tr>
<td>cron</td>
<td>系统定时任务cront和At产生的日志</td>
</tr>
<tr>
<td>daemon</td>
<td>守护进程相关的日志</td>
</tr>
<tr>
<td>ftp</td>
<td>ftp守护进程相关日志</td>
</tr>
<tr>
<td>kern</td>
<td>内核产生的日志</td>
</tr>
<tr>
<td>local0-local7</td>
<td>为本地预留的服务项</td>
</tr>
<tr>
<td>lpr</td>
<td>打印系统产生的日志</td>
</tr>
<tr>
<td>mail</td>
<td>邮件日志</td>
</tr>
<tr>
<td>news</td>
<td>新闻服务器相关日志</td>
</tr>
<tr>
<td>syslog</td>
<td>rsyslog服务产生的日志</td>
</tr>
<tr>
<td>user</td>
<td>用户等级类别产生的日志</td>
</tr>
<tr>
<td>uucp</td>
<td>uucp(数据传输协议)子系统的日志</td>
</tr>
</tbody></table>
</div>

<h5 id="连接符"><a href="#连接符" class="headerlink" title="连接符"></a>连接符</h5><div class="table">

<table>
<thead>
<tr>
<th>连接符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>表示比后面所写等级高(包含该等级)的日志都记录下来</td>
</tr>
<tr>
<td>.=</td>
<td>只记录指定等级的日志</td>
</tr>
<tr>
<td>.!</td>
<td>除了该等级，其余等级都记录</td>
</tr>
</tbody></table>
</div>

<h5 id="日志等级"><a href="#日志等级" class="headerlink" title="日志等级"></a>日志等级</h5><div class="table">

<table>
<thead>
<tr>
<th>等级</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>*</strong></td>
<td>所有等级</td>
</tr>
<tr>
<td>none</td>
<td>与*相反，不记录任何日志</td>
</tr>
<tr>
<td>debug</td>
<td>调试信息</td>
</tr>
<tr>
<td>info</td>
<td>通知信息，反馈系统状态</td>
</tr>
<tr>
<td>notice</td>
<td>提醒信息，程序可能存在潜在错误，但不影响运行</td>
</tr>
<tr>
<td>warning</td>
<td>警告信息，程序发现错误，暂且不影响运行</td>
</tr>
<tr>
<td>err</td>
<td>错误信息，服务出错停止运行，需要修复</td>
</tr>
<tr>
<td>crit</td>
<td>临界状态信息，服务宕机，且可能无法修复</td>
</tr>
<tr>
<td>alert</td>
<td>警报信息，服务宕机，影响系统运行</td>
</tr>
<tr>
<td>emerg</td>
<td>紧急信息，系统疼痛等级，系统濒临崩溃甚至已经崩溃</td>
</tr>
</tbody></table>
</div>

<h5 id="日志记录位置"><a href="#日志记录位置" class="headerlink" title="日志记录位置"></a>日志记录位置</h5><p>日志记录位置可以是以下值:</p>
<ul>
<li>路径，写于本机指定位置，如:/var/log/lastlog</li>
<li>系统设备，写于U盘或者通过打印机打印日志，如:/dev/lp0</li>
<li>转发到远程主机或日志服务器，如:@192.168.0.100:514</li>
<li>用户名，发送给指定用户，如:root</li>
<li>忽略或丢弃日志，如：~ ，直接丢弃</li>
</ul>
<h5 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h5><p>以下示例来源于centos7系统默认配置</p>
<div class="shell">cron.*                                                  /var/log/cron
所有等级的cron日志写于/var/log/cron文件中
*.emerg                                                 :omusrmsg:*
出现疼痛等级的日志时，发送给所有用户
*.info;mail.none;authpriv.none;cron.none                /var/log/messages
不记录任何私人身份验证消息
uucp,news.crit                                          /var/log/spooler
将uucp,news服务crit和更高级别的日志信息保存在指定文件中
</div>


<h4 id="日志轮替"><a href="#日志轮替" class="headerlink" title="日志轮替"></a>日志轮替</h4><p>日志轮替用于用新日志覆盖旧日志，其配置文件位于<span class="tips">/etc/logrotate.conf</span>，需要相关功能只需在配置文件中添加对应参数就即可。</p>
<div class="table">

<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>daily/weekly/monthly</td>
<td>日志轮替周期</td>
</tr>
<tr>
<td>rotate 数字</td>
<td>保留日志文件的个数，0为不备份</td>
</tr>
<tr>
<td>compress</td>
<td>日志轮替时，对旧日志进行压缩</td>
</tr>
<tr>
<td>create 权限值 所有者 所属组</td>
<td>建立新日志，并指定日志文件的权限、所有者、所属组</td>
</tr>
<tr>
<td>mail address</td>
<td>日志轮替时，日志内容发送到指定邮箱，如:mail <a href="mailto:&#x31;&#x31;&#64;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;">&#x31;&#x31;&#64;&#103;&#109;&#x61;&#105;&#x6c;&#x2e;&#x63;&#111;&#109;</a></td>
</tr>
<tr>
<td>missingok</td>
<td>日志不存在时，忽略该日志的警告信息</td>
</tr>
<tr>
<td>notifempty</td>
<td>如果日志文件为空，则不进行轮替</td>
</tr>
<tr>
<td>maxsize 大小</td>
<td>当日志文件到达指定大小，无论是否到轮替时间，都进行一次轮替，未到达指定大小但到达轮替周期，也进行轮替</td>
</tr>
<tr>
<td>minsize 大小</td>
<td>到达轮替时间时，如果日志文件达到该最小值时就进行轮替，否则不进行轮替</td>
</tr>
<tr>
<td>size 大小</td>
<td>时间周期设置无效，只有当日志文件大于指定大小才进行轮替</td>
</tr>
<tr>
<td>dateext</td>
<td>使用日期作为日志轮替文件名</td>
</tr>
</tbody></table>
</div>


<div class="broadcast color-yellow">
<div class="iconfont icon-dengpao14hao"></div>
<span class="tips">dateext</span>参数用于指定当前日期作为日志文件后缀名，如:secure-20210211。如果配置文件中没有该参数，则日志文件将以.1，.2作为文件名名后缀。如：当前日志文件为secure，进行轮替后该文件改名为secure.1，secure.1改为secure.2，而将新的日志文件命名为secure。</div>

<h5 id="配置文件内容"><a href="#配置文件内容" class="headerlink" title="配置文件内容"></a>配置文件内容</h5><p>通过RPM包安装的服务其日志会被自动识别配置轮替，通过源码包安装的服务需要自行添加配置，配置格式同本地配置的基本格式。</p>
<div class="shell"># see "man logrotate" for details
# rotate log files weekly
weekly

<p># keep 4 weeks worth of backlogs<br>rotate 4</p>
<p># create new (empty) log files after rotating old ones<br>create</p>
<p># use date as a suffix of the rotated file<br>dateext</p>
<p># uncomment this if you want your log files compressed<br>#compress</p>
<p># RPM packages drop log rotation information into this directory<br>include /etc/logrotate.d</p>
<p># no packages own wtmp and btmp – we’ll rotate them here<br>/var/log/wtmp {<br>    monthly<br>    create 0664 root utmp<br>    minsize 1M<br>    rotate 1<br>}<br>/var/log/btmp {<br>    missingok<br>    monthly<br>    create 0600 root utmp<br>    rotate 1<br>}<br>本地配置格式(若某参数同时设置了本地配置和全局配置，则本地配置生效)<br>日志路径 {<br>  配置参数<br>}<br>如：<br>/usr/local/apache/logs/access_log {<br>  daily      //每天进行日志轮替<br>  create    //日志轮替时新建日志，文件权限、所有者等信息默认<br>  rotate 30 //保留30份日志文件(即保留30天)<br>}</p>
</div>

<h5 id="手动进行日志轮替"><a href="#手动进行日志轮替" class="headerlink" title="手动进行日志轮替"></a>手动进行日志轮替</h5><p><span class="strong">logrotate [参数] 配置文件名</span></p>
<p>不添加任何参数时，将按配置文件进行轮替</p>
<ul>
<li>-v 显示日志轮替的过程</li>
<li>-f 无论是否达到轮替配置要求，强制进行日志轮替</li>
</ul>
<h3 id="备份与恢复"><a href="#备份与恢复" class="headerlink" title="备份与恢复"></a>备份与恢复</h3><h4 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h4><p><strong>完全备份：</strong>即把所有需要备份的数据全部备份， 在Linux 中，完全备份指将根目录下的所有文件进行备份。</p>
<p><strong>增量备份：</strong>指第一次进行完全备份，服务器运行一段时间后，比较当前数据和第一次备份数据之间的差异，只备份有差异的数据，之后的每次备份都只备份与上一次备份有差异的数据。</p>
<h5 id="一般需备份的数据"><a href="#一般需备份的数据" class="headerlink" title="一般需备份的数据"></a>一般需备份的数据</h5><ul>
<li><strong>/root/</strong>&emsp;管理员账户根目录</li>
<li><strong>/home/</strong>&emsp;普通用户家目录</li>
<li><strong>/var/spool/mail</strong>&emsp;邮件</li>
<li><strong>/etc/</strong>&emsp;重要服务的配置文件</li>
<li><strong>/var/log</strong>&emsp;常用服务的日志</li>
<li><strong>数据库数据、账户资料….</strong></li>
</ul>
<h4 id="dump文件备份系统"><a href="#dump文件备份系统" class="headerlink" title="dump文件备份系统"></a>dump文件备份系统</h4><h5 id="1-安装dump"><a href="#1-安装dump" class="headerlink" title="1. 安装dump"></a>1. 安装dump</h5><ul>
<li><strong>yum -y install dump</strong> (redhalt系列)</li>
<li><strong>apt-get install dump</strong> (debian系列)</li>
</ul>
<h5 id="2-dump命令"><a href="#2-dump命令" class="headerlink" title="2. dump命令"></a>2. dump命令</h5><p><span class="strong">dump [参数] 备份后文件名 原文件或目录</span></p>
<ul>
<li>-[0-9级别]&emsp;可选0-9备份级别</li>
<li>-f 文件名&emsp;指定备份后的文件名</li>
<li>-u&emsp;备份成功后，把备份时间、备份级别等信息记录在 /etc/dumpdates 文件中</li>
<li>-v&emsp;显示备份过程中更多的输出信息</li>
<li>-j&emsp;调用 bzlib 库压缩备份文件，其实就是把备份文件压缩为 .bz2 格式，默认压缩等级为2</li>
<li>-W&emsp;显示允许被 dump 的分区的备份等级及备份时间</li>
</ul>
<h5 id="3-备份操作"><a href="#3-备份操作" class="headerlink" title="3.备份操作"></a>3.备份操作</h5><p>对于某个文件或不是分区的目录，dump只能使用 0 级别进行完全备份。而备份分区或整块硬盘时，dump 通过“备份级别”实现增量备份，其中，0 级别是完全备份，1-9为增量备份。</p>
<p>当我们备份数据时，第一次备份应该使用 0 级别，dump会把所有数据完全备份一次；第二次备份就可以使用 1 级别了，它会和 0 级别进行比较，把 0 级别备份之后变化的数据进行备份；第三次备份使用  2 级别，2 级别会和 1 级别进行比较，把 1 级别备份之后变化的数据进行备份，以此类推。</p>
<h6 id="备份目录"><a href="#备份目录" class="headerlink" title="备份目录"></a>备份目录</h6><div class="show"># dump -0uj -f /new/home.bak.bz2 /home/
完全备份home目录到/new/home.bak.bz2路径下
</div>

<h6 id="备份分区"><a href="#备份分区" class="headerlink" title="备份分区"></a>备份分区</h6><div class="show">#df -h 
查看分区信息
# dump -0uj -f /root/boot.bak.bz2 /boot/
第一次备份进行完全备份，记录备份信息
# dump -1uj -f /root/boot.bak1.bz2 /boot/
第二次开始使用增量备份
# dump -W
查询分区的备份时间及备份级别(需要备份的时候添加u参数)
</div>

<h4 id="restore还原dump备份的文件"><a href="#restore还原dump备份的文件" class="headerlink" title="restore还原dump备份的文件"></a>restore还原dump备份的文件</h4><p><span class="strong">restore [模式选项] [-f 文件名]</span></p>
<p>-f用于指定备份文件文件名，模式选项有四个，只能选一个模式</p>
<ul>
<li>-C&emsp;比较模式，比较备份数据和现有数据的不同并返回(只能检测出数据修改或减少的部分，如果新增了数据不会被检测到)</li>
<li>-i&emsp;交互模式，手动选择需要恢复的文件</li>
<li>-t&emsp;查看模式，用于查看备份文件中拥有哪些文件和目录</li>
<li>-r&emsp;还原模式，用于数据还原(如果是增量备份，则需先还原首次完全备份的数据)</li>
</ul>
<div class="show"># restore -r -f /root/boot.bak.bz2
先还原增量备份中首次备份的数据
# restore -r -f /root/boot.bak.bz2
再还原第二次开始增量备份的数据
</div>

<div class="broadcast color-pink">
<div class="iconfont icon-yinle1"></div>
一般使用<span class="tips">bak</span>作为系统备份文件名后缀</div>
        </div>
    </div>
    <div class="post-nav">
        
            <div class="post-prev ">
                <a href="/blog/2021/12/29/Linux%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%85/">上一篇：Linux命令补充</a>
            </div>
            
            
                <div class="post-next">
                    <a href="/blog/2021/12/29/Linux%E7%94%A8%E6%88%B7%E4%B8%8E%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86/">下一篇：Linux用户与权限管理 </a>
                </div>
                 
    </div>
    <div class="container">
        <!--设计来源于B站-季夏小贞-->
        <div class="big-head"></div>
        <div class="ears"></div>
        <div class="body"></div>
        <div class="paws-front"></div>
        <div class="paws-back"></div>
        <div class="details"></div>
        <div class="tail"></div>
        <div class="sleep">
          <span class="s1">z</span>
          <span class="s2">z</span>
          <span class="s3">z</span>
          <span class="s4">z</span>
          <span class="s5">z</span>
        </div>
    </div>
</div>
<div class="right-menu">
    <a class="iconfont back-top" href="javascript:">&#xe655;</a>
    <div class="husky"></div>
  </div>
</div>

<script src="/blog/js/jquery.min.js"></script>
<script src="/blog/js/jquery.bumpytext.js"></script>
<script src="/blog/js/index.js"></script>
<script src="/blog/js/highlight.min.js"></script>
<script src="/blog/js/highlightjs-line-numbers.min.js"></script>
<script src="/blog/js/article.js"></script>

</body></html>